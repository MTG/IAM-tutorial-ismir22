
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Exploring Rāga Performance in Carnatic Music</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/myfile.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../landing.html">
                    Welcome!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction/setup.html">
   Setting everything up
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction/python.html">
   Python for audio processing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction/compiam.html">
   compIAM package
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Indian Art Music
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../indian_art_music/iam.html">
   What is Indian Art Music?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../indian_art_music/carnatic-music.html">
   Carnatic Music
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../indian_art_music/hindustani-music.html">
   Hindustani music
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Corpora and Datasets
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../corpora_and_datasets/corpora.html">
   Accessing the Dunya Corpora
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../corpora_and_datasets/datasets.html">
   Datasets
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Melodic Analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="tonic-identification.html">
   Tonic identification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pitch-extraction.html">
   Pitch extraction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="melodic-transcription.html">
   Melodic transcription
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="melodic-pattern-discovery.html">
   Melodic pattern dicovery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="raga-recognition.html">
   Automatic raga recognition
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Rhythmic Analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../rhythmic_analysis/meter_analysis.html">
   Meter analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../rhythmic_analysis/percussion-transcription.html">
   Percussion transcription
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Structure Analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../structure_analysis/music-segmentation.html">
   Music segmentation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Timbre Analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../timbre_analysis/stroke-classification.html">
   Stroke classification
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Resources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../resources/references.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../resources/acknowledgements.html">
   Acknowledgements
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../resources/citing.html">
   Citing this work
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/MTG/IAM-tutorial-ismir22/master?urlpath=tree/webbook/melodic_analysis/exploring-raga.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/MTG/IAM-tutorial-ismir22/blob/master/webbook/melodic_analysis/exploring-raga.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/MTG/IAM-tutorial-ismir22"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/MTG/IAM-tutorial-ismir22/issues/new?title=Issue%20on%20page%20%2Fmelodic_analysis/exploring-raga.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/melodic_analysis/exploring-raga.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#about-the-authors">
   About the authors
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#requirements-and-setup">
   Requirements and Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#background">
   1. Background
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-is-raga">
     1.1 What is rāga?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data">
   2. Data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exploring-the-saraga-dataset">
     2.1 Exploring the Saraga dataset
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#an-example-performance">
     2.2 An example performance
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pitch-analysis">
   3. Pitch analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#predominant-pitch-extraction">
     3.1 Predominant pitch extraction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualising-predominant-pitch">
     3.2 Visualising predominant pitch
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduction-to-pitch-density-plots">
     3.3 Introduction to pitch density plots
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pitch-density-extraction">
     3.4 Pitch density extraction
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#a-single-example">
       A single example
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fixing-tonic-errors-in-folded-plots">
       Fixing tonic errors in folded plots
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#extraction-across-the-datastet">
       Extraction across the datastet
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#extracting-predominant-pitch-tracks">
       Extracting predominant pitch tracks
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Pitch density extraction
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pitch-density-across-raga">
     3.5 Pitch density across rāga
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pitch-density-as-a-feature">
     3.6 Pitch density as a feature
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#performance-clustering">
     3.7 Performance clustering
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#melodic-pattern-analysis">
   4. Melodic pattern analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#melodic-feature-extraction">
     4.1 Melodic feature extraction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#self-similarity">
     4.2 Self similarity
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#segment-extraction">
     4.3 Segment extraction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#segment-grouping">
     4.4 Segment grouping
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exploring-results">
     4.5 Exploring results
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#annotations">
     4.6 Annotations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#evaluation">
     4.7 Evaluation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#discussion">
     4.8 Discussion
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   5. Conclusion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   6. References
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Exploring Rāga Performance in Carnatic Music</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#about-the-authors">
   About the authors
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#requirements-and-setup">
   Requirements and Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#background">
   1. Background
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-is-raga">
     1.1 What is rāga?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data">
   2. Data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exploring-the-saraga-dataset">
     2.1 Exploring the Saraga dataset
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#an-example-performance">
     2.2 An example performance
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pitch-analysis">
   3. Pitch analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#predominant-pitch-extraction">
     3.1 Predominant pitch extraction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualising-predominant-pitch">
     3.2 Visualising predominant pitch
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduction-to-pitch-density-plots">
     3.3 Introduction to pitch density plots
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pitch-density-extraction">
     3.4 Pitch density extraction
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#a-single-example">
       A single example
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fixing-tonic-errors-in-folded-plots">
       Fixing tonic errors in folded plots
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#extraction-across-the-datastet">
       Extraction across the datastet
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#extracting-predominant-pitch-tracks">
       Extracting predominant pitch tracks
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Pitch density extraction
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pitch-density-across-raga">
     3.5 Pitch density across rāga
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pitch-density-as-a-feature">
     3.6 Pitch density as a feature
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#performance-clustering">
     3.7 Performance clustering
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#melodic-pattern-analysis">
   4. Melodic pattern analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#melodic-feature-extraction">
     4.1 Melodic feature extraction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#self-similarity">
     4.2 Self similarity
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#segment-extraction">
     4.3 Segment extraction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#segment-grouping">
     4.4 Segment grouping
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exploring-results">
     4.5 Exploring results
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#annotations">
     4.6 Annotations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#evaluation">
     4.7 Evaluation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#discussion">
     4.8 Discussion
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   5. Conclusion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   6. References
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="exploring-raga-performance-in-carnatic-music">
<h1>Exploring Rāga Performance in Carnatic Music<a class="headerlink" href="#exploring-raga-performance-in-carnatic-music" title="Permalink to this headline">#</a></h1>
<p>Thomas Nuttall, Genís Plaja-Roglans, Lara Pearson, Brindha Manickavasakan</p>
<p>In this notebook we demonstrate the use of the <a class="reference external" href="https://github.com/MTG/compIAM/tree/master/compiam">compIAM</a> repository for a music analysis task. The task will touch on elements of ongoing research by the authors on the analysis of rāga in Carnatic Music. The idea is primarily to demonstrate how the repository could support musicological inquiry and music analysis whilst also shining a light on certain characteristics of Carnatic Music and demonstrating how the use of computational tools for music analysis can assist in making explicit some of the implicit knowledge held by musicians and practitioners. This notebook and the results presented in it do not intend to serve as a musicological study.</p>
<section id="about-the-authors">
<h2>About the authors<a class="headerlink" href="#about-the-authors" title="Permalink to this headline">#</a></h2>
<p>Many parts of this notebook and the accompanying discussion is directly taken from ongoing research between MIR researchers, Thomas Nuttall and Genís Plaja-Roglan; musicologist, Lara Pearson; and professional Carnatic vocalist, Brindha Manickavasakan. The objective of this collaboration is to develop computational processes that support musicological research of Carnatic Music, emphasising the importance of including performer’s perspectives from the outset and providing results interpretable by, and of use to, practitioners.</p>
</section>
<section id="requirements-and-setup">
<h2>Requirements and Setup<a class="headerlink" href="#requirements-and-setup" title="Permalink to this headline">#</a></h2>
<p>All code in the notebook can be ran using the compIAM package, some other, common, non-native packages are used, but these are all dependencies of compIAM and should be installed correctly with the installation of compIAM:</p>
<p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">compiam</span></code></p>
<p>An important thing to note is that this notebook relies on the <a class="reference external" href="https://mtg.github.io/saraga/">Saraga Carnatic Dataset</a>. It is advisable to have this (or at least part of this) downloaded before commencing. In its entirety, this dataset is &gt;20GB and can take time downloading (although it is also possible to download indiviudal tracks). Alternatively, we encourage the reader to use their own audio for the analysis.</p>
<p><strong>Table of Contents</strong></p>
<ol class="simple">
<li><p><a class="reference external" href="#1">Background</a><br>
1.1 <a class="reference external" href="#1.1">What is rāga?</a><br></p></li>
<li><p><a class="reference external" href="#2">Data</a><br>
2.1 <a class="reference external" href="#2.1">Exploring the Saraga Dataset</a><br>
2.2 <a class="reference external" href="#2.2">An example performance</a><br></p></li>
<li><p><a class="reference external" href="#3">Pitch analysis</a><br>
3.1 <a class="reference external" href="#3.1">Predominant pitch track extraction</a><br>
3.2 <a class="reference external" href="#3.2">Visualising pitch track</a><br>
3.3 <a class="reference external" href="#3.3">Introduction to pitch histograms</a><br>
3.4 <a class="reference external" href="#3.4">Histogram extraction</a><br>
3.5 <a class="reference external" href="#3.5">Pitch histogram across rāga</a><br>
3.6 <a class="reference external" href="#3.6">Pitch histogram as feature</a><br>
3.7 <a class="reference external" href="#3.7">Performance clustering</a><br></p></li>
<li><p><a class="reference external" href="#4">Melodic pattern analysis</a><br>
4.1 <a class="reference external" href="#4.1">Melodic feature extraction</a><br>
4.2 <a class="reference external" href="#4.2">Self similarity</a><br>
4.3 <a class="reference external" href="#4.3">Segment extraction</a><br>
4.4 <a class="reference external" href="#4.4">Segment grouping</a><br>
4.5 <a class="reference external" href="#4.5">Exploring results</a><br>
4.6 <a class="reference external" href="#4.6">Annotations</a><br>
4.7 <a class="reference external" href="#4.7">Evaluation</a><br>
4.8 <a class="reference external" href="#4.7">Discussion</a><br></p></li>
<li><p><a class="reference external" href="#5">Conclusion</a><br></p></li>
<li><p><a class="reference external" href="#6">References</a><br>
<a id='1'></a>
<a id='1.1'></a></p></li>
</ol>
<p>Let’s import compiam and get started!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">compiam</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="background">
<h2>1. Background<a class="headerlink" href="#background" title="Permalink to this headline">#</a></h2>
<section id="what-is-raga">
<h3>1.1 What is rāga?<a class="headerlink" href="#what-is-raga" title="Permalink to this headline">#</a></h3>
<p>The melodic frameworks on which Carnatic music is based are known as rāgas. One of the main aesthetic goals of Carnatic performance is the correct expression of rāga. Rāgas can be understood as collections of phrases or melodies, comprising gamakas (ornamentation) and svaras (notes) that are considered part of the melodic framework, and performed in ways that follow the grammar of the rāga. [1]</p>
<p><strong>Svaras</strong> are note-length units with theoretical pitch positions, and are referred to using sargam syllables – sa ri ga ma pa dha and ni. Sargam syllables are used in written notation, and also in certain musical formats when the svara names are sung.</p>
<p>In practice, most svaras are performed with <strong>gamakas</strong> (ornamentation), rather than as plain notes [2]. Therefore, although svaras are often referred to using the English term ‘notes’, they differ from notes in that the gamakas with which they are performed are considered integral to the svara [3]. Many rāgas involve heavy use of <strong>gamakas</strong> such as oscillations, slides and flicks to other pitches. It is important to note that gamakas are not superficial decoration but rather are integral to musical meaning [3]. Gamakas, can greatly alter the sound of the notated svaras (notes); for example, some gamakas do not rest at all on the theoretical pitch of the notated svara, and instead involve oscillations between pitches either side of it.</p>
<p>Another important feature of the style is the structural and expressive significance of motifs and phrases known as <strong>sañcāras</strong>, which can be defined as coherent segments of melodic movement that follow the grammar of the rāga [3, 4]. The term sañcāra comes from the Sanskrit root सञ्चर्, meaning to move. Although occasionally the term might be used to refer to phrases that are particularly characteristic of a rāga, the more common use of the term is in reference to any melodic segment that is coherent from a Carnatic music perspective.</p>
<p>These melodic patterns are the means through which the character of the rāga is expressed and they form the basis of various improvisatory and compositional formats in the style [3, 5]. There are no definitive lists of all possible sañcāras in each rāga, rather the body of existing compositions and the living oral tradition of rāga performance act as repositories for that knowledge.</p>
<p><em>(Text taken from <a class="reference external" href="https://mtg.github.io/IAM-tutorial-ismir22/indian_art_music/carnatic-music.html">accompanying webbook</a>)</em>
<a id='1.3'></a></p>
</section>
</section>
<section id="data">
<h2>2. Data<a class="headerlink" href="#data" title="Permalink to this headline">#</a></h2>
<section id="exploring-the-saraga-dataset">
<h3>2.1 Exploring the Saraga dataset<a class="headerlink" href="#exploring-the-saraga-dataset" title="Permalink to this headline">#</a></h3>
<p>CompIAM provides access to 8 Indian Art Music datasets via the <a class="reference external" href="https://github.com/mir-dataset-loaders/mirdata">mirdata library</a>. These datasets cover the Carnatic and Hindustani styles and include a mixture of melodic and rhythmic data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compiam</span><span class="o">.</span><span class="n">list_datasets</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;saraga_carnatic&#39;,
 &#39;saraga_hindustani&#39;,
 &#39;mridangam_stroke&#39;,
 &#39;four_way_tabla&#39;,
 &#39;compmusic_carnatic_rhythm&#39;,
 &#39;compmusic_hindustani_rhythm&#39;,
 &#39;compmusic_raga&#39;,
 &#39;compmusic_indian_tonic&#39;,
 &#39;compmusic_carnatic_varnam&#39;,
 &#39;scms&#39;]
</pre></div>
</div>
</div>
</div>
<p>The datasets can be accessed using <code class="docutils literal notranslate"><span class="pre">compiam.load_dataset()</span></code> and explored using the mirdata API. In this walkthrough we use the <a class="reference external" href="https://mtg.github.io/saraga/">Saraga Carnatic dataset</a>, which includes 249 individual carnatic performances from a range of performers across many rāgas. The performances are annotated with metadata such as tonic, rāga and tala and for 168 of them closed-microphone recordings of each individual instrument is included.</p>
<p>To load the dataset metadata pass a <code class="docutils literal notranslate"><span class="pre">data_home</span></code> to <code class="docutils literal notranslate"><span class="pre">load_dataset()</span></code>. This <code class="docutils literal notranslate"><span class="pre">data_home</span></code> should be a path to a directory where the mirdata has been/will be downloaded.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_home</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;saraga1.5_carnatic&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">saraga</span> <span class="o">=</span> <span class="n">compiam</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s1">&#39;saraga_carnatic&#39;</span><span class="p">,</span> <span class="n">data_home</span><span class="o">=</span><span class="n">data_home</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If the data is not yet downloaded you can download and validate it using:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#saraga.download()</span>
<span class="c1">#saraga.validate()</span>
</pre></div>
</div>
</div>
</div>
<p>The Saraga dataset is quite large, this step should take a relatively long time to complete.</p>
<p>To load all data relating to each track in the dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track_data</span> <span class="o">=</span> <span class="n">saraga</span><span class="o">.</span><span class="n">load_tracks</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Each track in <code class="docutils literal notranslate"><span class="pre">track_data</span></code> contains all path information relating to the performance, metadata (such as rāga, tala, performer) and some automatically extracted features such as tonic and preodminant pitch track.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track_data</span><span class="p">[</span><span class="s2">&quot;47_Koti_Janmani&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Track(
  audio_ghatam_path=&quot;...carnatic/Akkarai Sisters at Arkay by Akkarai Sisters/Koti Janmani/Koti Janmani.multitrack-ghatam.mp3&quot;,
  audio_mridangam_left_path=&quot;.../Akkarai Sisters at Arkay by Akkarai Sisters/Koti Janmani/Koti Janmani.multitrack-mridangam-left.mp3&quot;,
  audio_mridangam_right_path=&quot;...Akkarai Sisters at Arkay by Akkarai Sisters/Koti Janmani/Koti Janmani.multitrack-mridangam-right.mp3&quot;,
  audio_path=&quot;...tic/saraga1.5_carnatic/Akkarai Sisters at Arkay by Akkarai Sisters/Koti Janmani/Koti Janmani.mp3.mp3&quot;,
  audio_violin_path=&quot;...carnatic/Akkarai Sisters at Arkay by Akkarai Sisters/Koti Janmani/Koti Janmani.multitrack-violin.mp3&quot;,
  audio_vocal_path=&quot;..._carnatic/Akkarai Sisters at Arkay by Akkarai Sisters/Koti Janmani/Koti Janmani.multitrack-vocal.mp3&quot;,
  audio_vocal_s_path=&quot;...arnatic/Akkarai Sisters at Arkay by Akkarai Sisters/Koti Janmani/Koti Janmani.multitrack-vocal-s.mp3&quot;,
  ctonic_path=&quot;.../saraga1.5_carnatic/Akkarai Sisters at Arkay by Akkarai Sisters/Koti Janmani/Koti Janmani.ctonic.txt&quot;,
  metadata_path=&quot;...rnatic/saraga1.5_carnatic/Akkarai Sisters at Arkay by Akkarai Sisters/Koti Janmani/Koti Janmani.json&quot;,
  phrases_path=&quot;...5_carnatic/Akkarai Sisters at Arkay by Akkarai Sisters/Koti Janmani/Koti Janmani.mphrases-manual.txt&quot;,
  pitch_path=&quot;...c/saraga1.5_carnatic/Akkarai Sisters at Arkay by Akkarai Sisters/Koti Janmani/Koti Janmani.pitch.txt&quot;,
  pitch_vocal_path=None,
  sama_path=&quot;...ga1.5_carnatic/Akkarai Sisters at Arkay by Akkarai Sisters/Koti Janmani/Koti Janmani.sama-manual.txt&quot;,
  sections_path=&quot;...carnatic/Akkarai Sisters at Arkay by Akkarai Sisters/Koti Janmani/Koti Janmani.sections-manual-p.txt&quot;,
  tempo_path=&quot;...a1.5_carnatic/Akkarai Sisters at Arkay by Akkarai Sisters/Koti Janmani/Koti Janmani.tempo-manual.txt&quot;,
  track_id=&quot;47_Koti_Janmani&quot;,
  audio: The track&#39;s audio

        Returns,
  metadata: ,
  phrases: ,
  pitch: ,
  pitch_vocal: ,
  sama: ,
  sections: ,
  tempo: ,
  tonic: ,
)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track_data</span><span class="p">[</span><span class="s2">&quot;108_Pullum_Silambena_Kan&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">track_data</span><span class="p">[</span><span class="s2">&quot;108_Pullum_Silambena_Kan&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/mirdata/core.py:46,</span> in <span class="ni">cached_property.__get__</span><span class="nt">(self, obj, cls)</span>
<span class="g g-Whitespace">     </span><span class="mi">44</span> <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">45</span>     <span class="k">return</span> <span class="bp">self</span>
<span class="ne">---&gt; </span><span class="mi">46</span> <span class="n">value</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span> <span class="k">return</span> <span class="n">value</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/mirdata/datasets/saraga_carnatic.py:150,</span> in <span class="ni">Track.metadata</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">148</span> <span class="nd">@core</span><span class="o">.</span><span class="n">cached_property</span>
<span class="g g-Whitespace">    </span><span class="mi">149</span> <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">150</span>     <span class="k">return</span> <span class="n">load_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_path</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/mirdata/io.py:22,</span> in <span class="ni">coerce_to_string_io.&lt;locals&gt;.wrapper</span><span class="nt">(file_path_or_obj)</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>     <span class="k">return</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_path_or_obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">22</span>     <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path_or_obj</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span>         <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_path_or_obj</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">):</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/smart_open/smart_open_lib.py:177,</span> in <span class="ni">open</span><span class="nt">(uri, mode, buffering, encoding, errors, newline, closefd, opener, compression, transport_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">174</span> <span class="k">if</span> <span class="n">transport_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">175</span>     <span class="n">transport_params</span> <span class="o">=</span> <span class="p">{}</span>
<span class="ne">--&gt; </span><span class="mi">177</span> <span class="n">fobj</span> <span class="o">=</span> <span class="n">_shortcut_open</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">178</span>     <span class="n">uri</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">179</span>     <span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">180</span>     <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">181</span>     <span class="n">buffering</span><span class="o">=</span><span class="n">buffering</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">182</span>     <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">183</span>     <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">184</span>     <span class="n">newline</span><span class="o">=</span><span class="n">newline</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">185</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">186</span> <span class="k">if</span> <span class="n">fobj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">187</span>     <span class="k">return</span> <span class="n">fobj</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/smart_open/smart_open_lib.py:363,</span> in <span class="ni">_shortcut_open</span><span class="nt">(uri, mode, compression, buffering, encoding, errors, newline)</span>
<span class="g g-Whitespace">    </span><span class="mi">360</span> <span class="k">if</span> <span class="n">errors</span> <span class="ow">and</span> <span class="s1">&#39;b&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">361</span>     <span class="n">open_kwargs</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors</span>
<span class="ne">--&gt; </span><span class="mi">363</span> <span class="k">return</span> <span class="n">_builtin_open</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">buffering</span><span class="o">=</span><span class="n">buffering</span><span class="p">,</span> <span class="o">**</span><span class="n">open_kwargs</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;../data/saraga1.5_carnatic/saraga1.5_carnatic/Live at Vani Mahal by Sanjay Subrahmanyan/Pullum Silambena Kan/Sanjay Subrahmanyan - Pullum Silambena Kan.json&#39;
</pre></div>
</div>
</div>
</div>
<p>Explore some quick stats</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_tracks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">track_data</span><span class="p">)</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">metadata</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">t</span> <span class="ow">in</span> <span class="n">track_data</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

<span class="c1"># rāgas</span>
<span class="n">ragas</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;raaga&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">]</span>
<span class="n">ragas</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">r</span> <span class="k">else</span> <span class="s1">&#39;unknown&#39;</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ragas</span><span class="p">]</span>
<span class="n">unique_ragas</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ragas</span><span class="p">))</span>
<span class="n">n_ragas</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_ragas</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">n_tracks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">track_data</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">metadata</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">metadata</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">t</span> <span class="ow">in</span> <span class="n">track_data</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># rāgas</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">ragas</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;raaga&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">]</span>

<span class="nn">Cell In [10], line 2,</span> in <span class="ni">&lt;listcomp&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">n_tracks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">track_data</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">metadata</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">metadata</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">t</span> <span class="ow">in</span> <span class="n">track_data</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># rāgas</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">ragas</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;raaga&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">]</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/mirdata/core.py:46,</span> in <span class="ni">cached_property.__get__</span><span class="nt">(self, obj, cls)</span>
<span class="g g-Whitespace">     </span><span class="mi">44</span> <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">45</span>     <span class="k">return</span> <span class="bp">self</span>
<span class="ne">---&gt; </span><span class="mi">46</span> <span class="n">value</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span> <span class="k">return</span> <span class="n">value</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/mirdata/datasets/saraga_carnatic.py:150,</span> in <span class="ni">Track.metadata</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">148</span> <span class="nd">@core</span><span class="o">.</span><span class="n">cached_property</span>
<span class="g g-Whitespace">    </span><span class="mi">149</span> <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">150</span>     <span class="k">return</span> <span class="n">load_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_path</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/mirdata/io.py:22,</span> in <span class="ni">coerce_to_string_io.&lt;locals&gt;.wrapper</span><span class="nt">(file_path_or_obj)</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>     <span class="k">return</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_path_or_obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">22</span>     <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path_or_obj</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span>         <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_path_or_obj</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">):</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/smart_open/smart_open_lib.py:177,</span> in <span class="ni">open</span><span class="nt">(uri, mode, buffering, encoding, errors, newline, closefd, opener, compression, transport_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">174</span> <span class="k">if</span> <span class="n">transport_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">175</span>     <span class="n">transport_params</span> <span class="o">=</span> <span class="p">{}</span>
<span class="ne">--&gt; </span><span class="mi">177</span> <span class="n">fobj</span> <span class="o">=</span> <span class="n">_shortcut_open</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">178</span>     <span class="n">uri</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">179</span>     <span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">180</span>     <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">181</span>     <span class="n">buffering</span><span class="o">=</span><span class="n">buffering</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">182</span>     <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">183</span>     <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">184</span>     <span class="n">newline</span><span class="o">=</span><span class="n">newline</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">185</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">186</span> <span class="k">if</span> <span class="n">fobj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">187</span>     <span class="k">return</span> <span class="n">fobj</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/smart_open/smart_open_lib.py:363,</span> in <span class="ni">_shortcut_open</span><span class="nt">(uri, mode, compression, buffering, encoding, errors, newline)</span>
<span class="g g-Whitespace">    </span><span class="mi">360</span> <span class="k">if</span> <span class="n">errors</span> <span class="ow">and</span> <span class="s1">&#39;b&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">361</span>     <span class="n">open_kwargs</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors</span>
<span class="ne">--&gt; </span><span class="mi">363</span> <span class="k">return</span> <span class="n">_builtin_open</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">buffering</span><span class="o">=</span><span class="n">buffering</span><span class="p">,</span> <span class="o">**</span><span class="n">open_kwargs</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;../data/saraga1.5_carnatic/saraga1.5_carnatic/Sumitra Nitin at Arkay by Sumitra Nitin/Dorakuna/Dorakuna.json&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of recordings: </span><span class="si">{</span><span class="n">n_tracks</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;    across </span><span class="si">{</span><span class="n">n_ragas</span><span class="si">}</span><span class="s1"> distinct ragas...&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">unique_ragas</span><span class="p">[:</span><span class="mi">50</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;      ...&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of recordings: 249
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of recordings: </span><span class="si">{</span><span class="n">n_tracks</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;    across </span><span class="si">{</span><span class="n">n_ragas</span><span class="si">}</span><span class="s1"> distinct ragas...&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">unique_ragas</span><span class="p">[:</span><span class="mi">50</span><span class="p">]:</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;n_ragas&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p><a id='2.2'></a></p>
</section>
<section id="an-example-performance">
<h3>2.2 An example performance<a class="headerlink" href="#an-example-performance" title="Permalink to this headline">#</a></h3>
<p>Let us take a look at a particular performance for a chosen raga</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raga</span> <span class="o">=</span> <span class="s2">&quot;Rītigauḷa&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Get data for all performances related to this raga</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raga_tracks</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">track_data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="k">if</span> <span class="n">ragas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="n">raga</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">raga_tracks</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">track_data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="k">if</span> <span class="n">ragas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="n">raga</span><span class="p">}</span>

<span class="nn">Cell In [13], line 1,</span> in <span class="ni">&lt;dictcomp&gt;</span><span class="nt">(.0)</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">raga_tracks</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">track_data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="k">if</span> <span class="n">ragas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="n">raga</span><span class="p">}</span>

<span class="ne">NameError</span>: name &#39;ragas&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>List all titles and artists for this raga</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">raga_tracks</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">raga</span><span class="si">}</span><span class="s2"> performances...&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">rt</span> <span class="ow">in</span> <span class="n">raga_tracks</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">rt</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;album_artists&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="n">concert</span> <span class="o">=</span> <span class="n">rt</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;concert&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">rt</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;    </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1"> by </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> from </span><span class="si">{</span><span class="n">concert</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">raga_tracks</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">raga</span><span class="si">}</span><span class="s2"> performances...&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="k">for</span> <span class="n">rt</span> <span class="ow">in</span> <span class="n">raga_tracks</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">name</span> <span class="o">=</span> <span class="n">rt</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;album_artists&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;raga_tracks&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Take an example performance from the list</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># performance number</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">raga_tracks</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;album_artists&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<span class="n">concert</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;concert&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
<span class="n">title</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">track</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">raga_tracks</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">name</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;album_artists&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">concert</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;concert&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;raga_tracks&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1"> by </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> from </span><span class="si">{</span><span class="n">concert</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1"> by </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> from </span><span class="si">{</span><span class="n">concert</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;title&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>The track object contains paths to audio for all instrument tracks. As mentioned, some performances include close-microphone recordings so we can extract each track corresponding to each of those</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Mix</span>
<span class="n">audio_path</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">audio_path</span>
<span class="c1"># Ghatam</span>
<span class="n">ghatam_path</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">audio_ghatam_path</span>
<span class="c1"># Mridangam </span>
<span class="n">mridangam_left</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">audio_mridangam_left_path</span>
<span class="n">mridangam_right</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">audio_mridangam_right_path</span>
<span class="c1"># Violin</span>
<span class="n">violin_path</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">audio_violin_path</span>
<span class="c1"># Vocal</span>
<span class="n">vocal_path</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">audio_vocal_path</span>
<span class="n">accompanying_vocal_path</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">audio_vocal_s_path</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Mix</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">audio_path</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">audio_path</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="c1"># Ghatam</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">ghatam_path</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">audio_ghatam_path</span>

<span class="ne">NameError</span>: name &#39;track&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>However, not all tracks do have individual instrument tracks. For those that don’t, we take the mixed path, stored in the <code class="docutils literal notranslate"><span class="pre">audio_path</span></code> attribute</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">vocal_path</span><span class="p">,</span> <span class="n">accompanying_vocal_path</span><span class="p">,</span> <span class="n">violin_path</span><span class="p">,</span> <span class="n">mridangam_left</span><span class="p">,</span> <span class="n">mridangam_right</span><span class="p">,</span> <span class="n">ghatam_path</span><span class="p">]</span>
<span class="n">_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Vocal&quot;</span><span class="p">,</span> <span class="s2">&quot;Accompanying vocal&quot;</span><span class="p">,</span> <span class="s2">&quot;Violin&quot;</span><span class="p">,</span> <span class="s2">&quot;Mridangam left&quot;</span><span class="p">,</span> <span class="s2">&quot;Mridangam right&quot;</span><span class="p">,</span> <span class="s2">&quot;Ghatam&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">vocal_path</span><span class="p">,</span> <span class="n">accompanying_vocal_path</span><span class="p">,</span> <span class="n">violin_path</span><span class="p">,</span> <span class="n">mridangam_left</span><span class="p">,</span> <span class="n">mridangam_right</span><span class="p">,</span> <span class="n">ghatam_path</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Vocal&quot;</span><span class="p">,</span> <span class="s2">&quot;Accompanying vocal&quot;</span><span class="p">,</span> <span class="s2">&quot;Violin&quot;</span><span class="p">,</span> <span class="s2">&quot;Mridangam left&quot;</span><span class="p">,</span> <span class="s2">&quot;Mridangam right&quot;</span><span class="p">,</span> <span class="s2">&quot;Ghatam&quot;</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;vocal_path&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">_paths</span> <span class="k">if</span> <span class="n">p</span><span class="p">]</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">_paths</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No multitrack found, using mix&#39;</span><span class="p">)</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="n">audio_path</span>
    <span class="n">names</span> <span class="o">=</span> <span class="s1">&#39;Mix&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">_paths</span> <span class="k">if</span> <span class="n">p</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">_paths</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

<span class="ne">NameError</span>: name &#39;_paths&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>compIAM includes a waveform visualiser and audio player (from <a class="reference external" href="https://naomiaro.github.io/waveform-playlist/">waveform-playlist</a>) that allows easily exploration of multiple audios.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">compiam.visualisation.waveform_player</span> <span class="kn">import</span> <span class="n">Player</span>
</pre></div>
</div>
</div>
</div>
<p>We can load each individual track and listen to them together and in isolation</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Player</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">paths</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">Player</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">paths</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;names&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p><a id='3'></a>
<a id='3.1'></a></p>
</section>
</section>
<section id="pitch-analysis">
<h2>3. Pitch analysis<a class="headerlink" href="#pitch-analysis" title="Permalink to this headline">#</a></h2>
<section id="predominant-pitch-extraction">
<h3>3.1 Predominant pitch extraction<a class="headerlink" href="#predominant-pitch-extraction" title="Permalink to this headline">#</a></h3>
<p>Owing to the the coarticulation (merging) of svaras through gamakas, musically salient units in Carnatic Music are often better characterised by continuous time series pitch data rather than transcription to symbolic notation [6, 7].</p>
<p>However, Carnatic Music constitutes a difficult case for vocal pitch extraction – although performances place strong emphasis on a monophonic melodic line from the soloist singer, heterophonic melodic elements also occur, for example from the accompanying violinist who shadows the melody of the soloist often at a lag and with variation. In addition, there are the sounds of the tanpura (plucked lute that creates an oscillating drone) and pitched percussion instruments [8].</p>
<p>Here we use a pretrained FTA-Net model for the task. This is provided with the compIAM package via the <code class="docutils literal notranslate"><span class="pre">compiam.load_model()</span></code> function. The model is an attention-based network that leverages and fuses information from the frequency and periodicity domains to capture the correct pitch values for the predominant source. It learns to focus on this source by using an additional branch that helps reduce the false alarm rate (detecting pitch values that do not correspond to the source we target) [9].</p>
<p>This FTANet instance is trained on the <a class="reference external" href="https://zenodo.org/record/5553925">Saraga Carnatic Melody Synth dataset (SMCS)</a>, a dataset including more than 1000 minutes of time-aligned and continuous vocal melody annotations for the Carnatic music tradition [10].</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ftanet</span> <span class="o">=</span> <span class="n">compiam</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;melody:ftanet-carnatic&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-11-29 12:08:15.052314: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libcudart.so.11.0&#39;; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/cv2/../../lib64:
2023-11-29 12:08:15.052341: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-11-29 12:08:16.217724: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libcuda.so.1&#39;; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/cv2/../../lib64:
2023-11-29 12:08:16.217749: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)
2023-11-29 12:08:16.217768: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (fv-az1022-658): /proc/driver/nvidia/version does not exist
2023-11-29 12:08:16.217949: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
</pre></div>
</div>
</div>
</div>
<p>Extract predominant pitch track</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pitch_track</span> <span class="o">=</span> <span class="n">ftanet</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">audio_path</span><span class="p">)</span>
<span class="n">pitch</span> <span class="o">=</span> <span class="n">pitch_track</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Pitch in Hz</span>
<span class="n">time</span>  <span class="o">=</span> <span class="n">pitch_track</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Time in seconds</span>
<span class="n">timestep</span>  <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">time</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># time in seconds between elements of pitch track</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">pitch_track</span> <span class="o">=</span> <span class="n">ftanet</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">audio_path</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">pitch</span> <span class="o">=</span> <span class="n">pitch_track</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Pitch in Hz</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">time</span>  <span class="o">=</span> <span class="n">pitch_track</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Time in seconds</span>

<span class="ne">NameError</span>: name &#39;audio_path&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>We can interpolate small silences to account for minor errors in the pitch exrraction process, typically caused by glottal sounds and sudden decrease of pitch salience in gamakas [6].</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">compiam.utils.pitch</span> <span class="kn">import</span> <span class="n">interpolate_below_length</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pitch</span> <span class="o">=</span> <span class="n">interpolate_below_length</span><span class="p">(</span>
    <span class="n">pitch</span><span class="p">,</span> <span class="c1"># track to interpolate</span>
    <span class="mi">0</span><span class="p">,</span> <span class="c1"># value to interpolate </span>
    <span class="mi">350</span><span class="o">*</span><span class="mf">0.001</span><span class="o">/</span><span class="n">timestep</span> <span class="c1"># maximum gap in number sequence elements to interpolate for</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">pitch</span> <span class="o">=</span> <span class="n">interpolate_below_length</span><span class="p">(</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="n">pitch</span><span class="p">,</span> <span class="c1"># track to interpolate</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="mi">0</span><span class="p">,</span> <span class="c1"># value to interpolate </span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="mi">350</span><span class="o">*</span><span class="mf">0.001</span><span class="o">/</span><span class="n">timestep</span> <span class="c1"># maximum gap in number sequence elements to interpolate for</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;pitch&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p><a id='3.2'></a></p>
</section>
<section id="visualising-predominant-pitch">
<h3>3.2 Visualising predominant pitch<a class="headerlink" href="#visualising-predominant-pitch" title="Permalink to this headline">#</a></h3>
<p>We can plot our pitch track using the visualisation tools in <code class="docutils literal notranslate"><span class="pre">compiam.visualisation</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">compiam.visualisation.pitch</span> <span class="kn">import</span> <span class="n">plot_pitch</span><span class="p">,</span> <span class="n">flush_matplotlib</span>
<span class="kn">from</span> <span class="nn">compiam.utils</span> <span class="kn">import</span> <span class="n">ipy_audio</span>
</pre></div>
</div>
</div>
</div>
<p>We want to accompany pitch plots with audio so load raw audio too</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let&#39;s load the audio also</span>
<span class="kn">import</span> <span class="nn">librosa</span>
<span class="n">sr</span> <span class="o">=</span> <span class="mi">44100</span> <span class="c1"># sampling_rate</span>
<span class="n">audio</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">audio_path</span><span class="p">,</span><span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">],</span> <span class="n">line</span> <span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">librosa</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">sr</span> <span class="o">=</span> <span class="mi">44100</span> <span class="c1"># sampling_rate</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">audio</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">audio_path</span><span class="p">,</span><span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;audio_path&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t1</span> <span class="o">=</span> <span class="mi">304</span> <span class="c1"># in seconds</span>
<span class="n">t2</span> <span class="o">=</span> <span class="mi">324</span> <span class="c1"># in seconds</span>
<span class="n">t1s</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">t1</span><span class="o">/</span><span class="n">timestep</span><span class="p">)</span> <span class="c1"># in sequence elements</span>
<span class="n">t2s</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">t2</span><span class="o">/</span><span class="n">timestep</span><span class="p">)</span> <span class="c1"># in sequence elements</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">t1</span> <span class="o">=</span> <span class="mi">304</span> <span class="c1"># in seconds</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">t2</span> <span class="o">=</span> <span class="mi">324</span> <span class="c1"># in seconds</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">t1s</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">t1</span><span class="o">/</span><span class="n">timestep</span><span class="p">)</span> <span class="c1"># in sequence elements</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">t2s</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">t2</span><span class="o">/</span><span class="n">timestep</span><span class="p">)</span> <span class="c1"># in sequence elements</span>

<span class="ne">NameError</span>: name &#39;timestep&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">this_pitch</span> <span class="o">=</span> <span class="n">pitch</span><span class="p">[</span><span class="n">t1s</span><span class="p">:</span><span class="n">t2s</span><span class="p">]</span>
<span class="n">this_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="n">t1s</span><span class="p">:</span><span class="n">t2s</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">this_pitch</span> <span class="o">=</span> <span class="n">pitch</span><span class="p">[</span><span class="n">t1s</span><span class="p">:</span><span class="n">t2s</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">this_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="n">t1s</span><span class="p">:</span><span class="n">t2s</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;pitch&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_pitch</span><span class="p">(</span><span class="n">this_pitch</span><span class="p">,</span> <span class="n">this_time</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Excerpt of </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1"> by </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ipy_audio</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">plot_pitch</span><span class="p">(</span><span class="n">this_pitch</span><span class="p">,</span> <span class="n">this_time</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Excerpt of </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1"> by </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">ipy_audio</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;this_pitch&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>The plot is OK but we could definitely make it more interpretable. First of all, since silences are represented as 0Hz in our predominant pitch track, the interpolation between points creates large drops to 0 for these regions. We can pass a binary mask to <code class="docutils literal notranslate"><span class="pre">plot_pitch</span></code> to tell it not to plot certain areas. In this case we want this mask to be 1 when there is non-silence (non-zero) and 1 otherwise:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">silence_mask</span> <span class="o">=</span> <span class="n">this_pitch</span><span class="o">==</span><span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">silence_mask</span> <span class="o">=</span> <span class="n">this_pitch</span><span class="o">==</span><span class="mi">0</span>

<span class="ne">NameError</span>: name &#39;this_pitch&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_pitch</span><span class="p">(</span><span class="n">this_pitch</span><span class="p">,</span> <span class="n">this_time</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">silence_mask</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Excerpt of </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1"> by </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ipy_audio</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">plot_pitch</span><span class="p">(</span><span class="n">this_pitch</span><span class="p">,</span> <span class="n">this_time</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">silence_mask</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Excerpt of </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1"> by </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">ipy_audio</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;this_pitch&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Pitch is often thought about in terms of it’s relationship to the tonic (Sa), which we can quantify using cents. A tonic identifier is provided in <code class="docutils literal notranslate"><span class="pre">compiam.melody</span></code>, or alternatively the tonic may be provided precomputed in the Saraga Dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">compiam.melody</span> <span class="kn">import</span> <span class="n">tonic_identification</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#tonicExt = tonic_identification.TonicIndianMultiPitch()</span>
<span class="n">tonic</span> <span class="o">=</span> <span class="mf">195.99</span>
</pre></div>
</div>
</div>
</div>
<p>Passing this tonic to <code class="docutils literal notranslate"><span class="pre">plot_pitch</span></code> converts the plotted curve to cents</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_pitch</span><span class="p">(</span><span class="n">this_pitch</span><span class="p">,</span> <span class="n">this_time</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">silence_mask</span><span class="p">,</span> <span class="n">tonic</span><span class="o">=</span><span class="n">tonic</span><span class="p">,</span> <span class="n">cents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Excerpt of </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1"> by </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ipy_audio</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">plot_pitch</span><span class="p">(</span><span class="n">this_pitch</span><span class="p">,</span> <span class="n">this_time</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">silence_mask</span><span class="p">,</span> <span class="n">tonic</span><span class="o">=</span><span class="n">tonic</span><span class="p">,</span> <span class="n">cents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Excerpt of </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1"> by </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">ipy_audio</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;this_pitch&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Finally we go one step further and replace the cents ticks on the y-axis with the expected svaras for this raga, plotted at their theoretical pitch positions on an equal tempered scale.</p>
<p>For a growing list of ragas, these theoretical svara:pitch mappings are available from <code class="docutils literal notranslate"><span class="pre">compiam.utils.get_svara_pitch_carnatic</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">compiam.utils</span> <span class="kn">import</span> <span class="n">get_svara_pitch_carnatic</span>
</pre></div>
</div>
</div>
</div>
<p>It is not uncommon to observe variations in how raga names (and more broadly, Indian Art Music terms) are transliterated from their original Indian language to latin-script. This makes it difficult to create key value mappings using these terms. If an unknown raga is passed to <code class="docutils literal notranslate"><span class="pre">get_svara_pitch_carnatic</span></code>, a list of closest matches are suggested as alternatives (if any exists).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_svara_pitch_carnatic</span><span class="p">(</span><span class="n">raga</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">get_svara_pitch_carnatic</span><span class="p">(</span><span class="n">raga</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/compiam/utils/__init__.py:123,</span> in <span class="ni">get_svara_pitch_carnatic</span><span class="nt">(raga, tonic)</span>
<span class="g g-Whitespace">    </span><span class="mi">122</span> <span class="k">def</span> <span class="nf">get_svara_pitch_carnatic</span><span class="p">(</span><span class="n">raga</span><span class="p">,</span> <span class="n">tonic</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">123</span>     <span class="n">svara_pitch</span> <span class="o">=</span> <span class="n">get_svara_pitch</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">124</span>         <span class="n">raga</span><span class="p">,</span> <span class="n">tonic</span><span class="p">,</span> <span class="n">svara_cents_carnatic_path</span><span class="p">,</span> <span class="n">svara_lookup_carnatic_path</span>
<span class="g g-Whitespace">    </span><span class="mi">125</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">126</span>     <span class="k">return</span> <span class="n">svara_pitch</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/compiam/utils/__init__.py:139,</span> in <span class="ni">get_svara_pitch</span><span class="nt">(raga, tonic, svara_cents_path, svara_lookup_path)</span>
<span class="g g-Whitespace">    </span><span class="mi">137</span>     <span class="k">if</span> <span class="n">close</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">138</span>         <span class="n">error_message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; Nearest matches: </span><span class="si">{</span><span class="n">close</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="ne">--&gt; </span><span class="mi">139</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">141</span> <span class="n">arohana</span> <span class="o">=</span> <span class="n">svara_lookup</span><span class="p">[</span><span class="n">raga</span><span class="p">][</span><span class="s2">&quot;arohana&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">142</span> <span class="n">avorohana</span> <span class="o">=</span> <span class="n">svara_lookup</span><span class="p">[</span><span class="n">raga</span><span class="p">][</span><span class="s2">&quot;avorohana&quot;</span><span class="p">]</span>

<span class="ne">ValueError</span>: Raga, Rītigauḷa not available in conf. Nearest matches: [&#39;ritigaula&#39;]
</pre></div>
</div>
</div>
</div>
<p>Passing the tonic returns these pitches in Hz, else they are returned in cents:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">svara_pitch</span> <span class="o">=</span> <span class="n">get_svara_pitch_carnatic</span><span class="p">(</span><span class="s1">&#39;ritigaula&#39;</span><span class="p">,</span> <span class="n">tonic</span><span class="o">=</span><span class="n">tonic</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">svara_pitch</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{65.40381575469627: &#39;M1&#39;,
 130.80763150939254: &#39;M1&#39;,
 261.6152630187851: &#39;M1&#39;,
 523.2305260375701: &#39;M1&#39;,
 1046.46105207514: &#39;M1&#39;,
 87.30361988416256: &#39;N2&#39;,
 174.60723976832512: &#39;N2&#39;,
 349.21447953665023: &#39;N2&#39;,
 698.4289590733005: &#39;N2&#39;,
 1396.857918146601: &#39;N2&#39;,
 58.268175617345825: &#39;G2&#39;,
 116.53635123469165: &#39;G2&#39;,
 233.0727024693833: &#39;G2&#39;,
 466.1454049387666: &#39;G2&#39;,
 932.2908098775332: &#39;G2&#39;,
 82.40364421278775: &#39;D2&#39;,
 164.8072884255755: &#39;D2&#39;,
 329.614576851151: &#39;D2&#39;,
 659.229153702302: &#39;D2&#39;,
 1318.458307404604: &#39;D2&#39;,
 48.9975: &#39;S&#39;,
 97.995: &#39;S&#39;,
 195.99: &#39;S&#39;,
 391.98: &#39;S&#39;,
 783.96: &#39;S&#39;,
 54.997834212038505: &#39;R2&#39;,
 109.99566842407701: &#39;R2&#39;,
 219.99133684815402: &#39;R2&#39;,
 439.98267369630804: &#39;R2&#39;,
 879.965347392616: &#39;R2&#39;,
 73.4133009992652: &#39;P&#39;,
 146.8266019985304: &#39;P&#39;,
 293.6532039970608: &#39;P&#39;,
 587.3064079941216: &#39;P&#39;,
 1174.6128159882435: &#39;P&#39;}
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">plot_pitch</span></code> accepts alternative y ticks in the format <code class="docutils literal notranslate"><span class="pre">y-values:label</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_pitch</span><span class="p">(</span><span class="n">this_pitch</span><span class="p">,</span> <span class="n">this_time</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">silence_mask</span><span class="p">,</span> <span class="n">tonic</span><span class="o">=</span><span class="n">tonic</span><span class="p">,</span> <span class="n">yticks_dict</span><span class="o">=</span><span class="n">svara_pitch</span><span class="p">,</span> <span class="n">cents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Excerpt of </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1"> by </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ipy_audio</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">plot_pitch</span><span class="p">(</span><span class="n">this_pitch</span><span class="p">,</span> <span class="n">this_time</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">silence_mask</span><span class="p">,</span> <span class="n">tonic</span><span class="o">=</span><span class="n">tonic</span><span class="p">,</span> <span class="n">yticks_dict</span><span class="o">=</span><span class="n">svara_pitch</span><span class="p">,</span> <span class="n">cents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Excerpt of </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1"> by </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">ipy_audio</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;this_pitch&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>It should be noted that Carnatic music does not use the equal tempered scale, and indeed that the same svara position, e.g., R2, may be deliberately placed slightly differently in different ragas. Therefore, any deviation here from those theoretical pitch positions does not indicate an error in intonation, but more likely reflects correct musical practice in the style or slight errors in the automated calculation of the tonic.
<a id='3.3'></a></p>
</section>
<section id="introduction-to-pitch-density-plots">
<h3>3.3 Introduction to pitch density plots<a class="headerlink" href="#introduction-to-pitch-density-plots" title="Permalink to this headline">#</a></h3>
<p>Pitch density plots represent the probability density function (PDF) of the continuous variable, pitch, across a series of observations. Here we achieve this using <strong>kernel density estimation</strong>.</p>
<p><strong>Kernel density estimation</strong> is a non-parametric method of estimating the PDF of a continuous random variable.  It is non-parametric because it does not assume any underlying distribution for the variable.  Essentially, at every datum, a kernel function is created with the datum at its centre – this ensures that the kernel is symmetric about the datum.  The PDF is then estimated by adding all of these kernel functions and dividing by the number of data to ensure that it satisfies the 2 properties of a PDF:</p>
<ol class="simple">
<li><p>Every possible value of the PDF (i.e. the function, f(x)), is non-negative.</p></li>
<li><p>The definite integral of the PDF over its support set equals to 1.</p></li>
</ol>
<p>To <strong>construct a kernel density estimate</strong>:</p>
<ol class="simple">
<li><p>Choose a kernel, here we use Gaussian (also popular are rectangular and triangular).</p></li>
<li><p>At each datum, <span class="math notranslate nohighlight">\(x_i\)</span>, build the scaled kernel function:</p></li>
</ol>
<center>$h^{-1}K[(x - x_i)/h]$</center>
<p>where <span class="math notranslate nohighlight">\(K()\)</span> is your chosen kernel function and <span class="math notranslate nohighlight">\(h\)</span>, the bandwidth.</p>
<ol class="simple">
<li><p>Add all of the individual scaled kernel functions and divide by <span class="math notranslate nohighlight">\(n\)</span>; this places a probability of <span class="math notranslate nohighlight">\(1/n\)</span> to each <span class="math notranslate nohighlight">\(x_i\)</span>. It also ensures that the kernel density estimate integrates to 1 over its support set.</p></li>
</ol>
<center>$\hat{f}(x) = n^{-1}h^{-1}\sum_{i=1}^{n}K[(x - x_i)/h]$</center>
<p><strong>Intuitively</strong>, a kernel density estimate is a sum of “bumps”.  A “bump” is assigned to every datum, and the size of the “bump” represents the probability assigned at the neighbourhood of values around that datum; thus, if the data set contains…</p>
<ul class="simple">
<li><p>2 data at x = 250</p></li>
<li><p>1 datum at x = 430</p></li>
</ul>
<p>…then the “bump” at x = 250 is twice as big as the “bump” at x = 430</p>
<p>Comparison of the histogram (left) and kernel density estimate (right) constructed using the same data. The six individual kernels are the red dashed curves, the kernel density estimate the blue curves. (Source: <a class="reference external" href="https://en.wikipedia.org/wiki/Kernel_density_estimation#/media/File:Comparison_of_1D_histogram_and_KDE.png">Wikimedia Commons</a>):</p>
<div>
<figure>
<img src="../images/KDE.png" width="500"/>
</figure>
</div>
<p>Each “bump” is centred at the datum, and it spreads out symmetrically to cover the datum’s neighbouring values.  Each kernel has a bandwidth, and it determines the width of the “bump” (the width of the neighbourhood of values to which probability is assigned).  A bigger bandwidth results in a shorter and wider “bump” that spreads out farther from the centre and assigns more probability to the neighbouring values.</p>
<p>The most important parameter is the <strong>bandwidth</strong>, <span class="math notranslate nohighlight">\(h\)</span>. A useful guideline in selecting this value is</p>
<ul class="simple">
<li><p>A small bandwidth results in a small standard deviation, and the kernel places most of the probability on the datum.  Use this when the sample size is large and the data are tightly packed.</p></li>
<li><p>A large bandwidth results in a large standard deviation, and the kernel spreads more of the probability from the datum to its neighbouring values.  Use this when the sample size is small and the data are sparse.</p></li>
</ul>
<p>Pitch distributions have proven useful in MIR tasks for IAM…</p>
<ul class="simple">
<li><p>Raga and tonic identification - <a class="reference external" href="https://link.springer.com/article/10.1007/s00521-018-3849-7">Samsekai Manjabhat, S., et al. “Raga and tonic identification in carnatic music.” Journal of New Music Research 46.3 (2017): 229-245.</a></p></li>
<li><p>Segmentation/melodic pattern discovery - <a class="reference external" href="https://repositori.upf.edu/handle/10230/35683">Gulati, Sankalp, et al. “Landmark detection in hindustani music melodies.” Georgaki A, Kouroupetroglou G, eds. Proceedings of the 2014 International Computer Music Conference, ICMC/SMC; 2014</a></p></li>
</ul>
<p>and likewise in supporting musicological discussion…</p>
<ul class="simple">
<li><p>Analysis rāga ālāpana <a class="reference external" href="https://www.jstor.org/stable/833817">Viswanathan, Tanjore. “The analysis of rāga ālāpana in South Indian music.” Asian Music (1977): 13-71.</a></p></li>
<li><p>Intonation analysis - <a class="reference external" href="https://repositori.upf.edu/bitstream/handle/10230/22728/Koduri_ISMIR_2012.pdf?sequence=1&amp;isAllowed=y">Koduri, Gopala Krishna, Joan Serrà Julià, and Xavier Serra. “Characterization of intonation in carnatic music by parametrizing pitch histograms.” Gouyon F, Herrera P, Martins LG, Müller M. ISMIR 2012: Proceedings of the 13th International Society for Music Information Retrieval Conference; 2012</a></p></li>
</ul>
<p>(Text adapted from <em><a class="reference external" href="https://chemicalstatistician.wordpress.com/2013/06/09/exploratory-data-analysis-kernel-density-estimation-in-r-on-ozone-pollution-data-in-new-york-and-ozonopolis/">Exploratory Data Analysis: Kernel Density Estimation – Conceptual Foundations - Eric Cai</a></em>)
<a id='3.4'></a></p>
</section>
<section id="pitch-density-extraction">
<h3>3.4 Pitch density extraction<a class="headerlink" href="#pitch-density-extraction" title="Permalink to this headline">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">get_pitch_density()</span></code> function in <code class="docutils literal notranslate"><span class="pre">compiam.visualisation.pitch</span></code> returns a density plot of the input array, specifically formatted for the context of pitch.</p>
<section id="a-single-example">
<h4>A single example<a class="headerlink" href="#a-single-example" title="Permalink to this headline">#</a></h4>
<p>Let’s us take a look at the pitch density plot for our chosen performance. Seaborn provides a kernel density estimation plotter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</pre></div>
</div>
</div>
</div>
<p>We want to investigate pitch as measure in cents above the tonic. There is a converter in <code class="docutils literal notranslate"><span class="pre">compiam.utils.pitch</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">compiam.utils.pitch</span> <span class="kn">import</span> <span class="n">pitch_seq_to_cents</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pitch_cents</span> <span class="o">=</span> <span class="n">pitch_seq_to_cents</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="n">tonic</span><span class="o">=</span><span class="n">tonic</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">44</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">pitch_cents</span> <span class="o">=</span> <span class="n">pitch_seq_to_cents</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="n">tonic</span><span class="o">=</span><span class="n">tonic</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;pitch&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Silences are represented by Nones, we must remove those</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pitch_cents</span><span class="p">[</span><span class="n">pitch_cents</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="kc">None</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">45</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pitch_cents</span><span class="p">[</span><span class="n">pitch_cents</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="kc">None</span><span class="p">)]</span>

<span class="ne">NameError</span>: name &#39;pitch_cents&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Computing and plotting with seaborn</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># One octave... shouldn&#39;t need to specify</span>
<span class="c1"># plot setup</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="c1"># plot background colour</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;#f2f2f2&#39;</span><span class="p">)</span>

<span class="c1"># turn off y ticks</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([],</span> <span class="p">[])</span>

<span class="c1"># Axis labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pitch (cents)&#39;</span><span class="p">)</span>

<span class="c1"># Plot using seaborn</span>
<span class="n">spltp</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">bw_method</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

<span class="c1"># store data</span>
<span class="n">unfolded_data</span> <span class="o">=</span> <span class="n">spltp</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xydata</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">47</span><span class="p">],</span> <span class="n">line</span> <span class="mi">18</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pitch (cents)&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="c1"># Plot using seaborn</span>
<span class="ne">---&gt; </span><span class="mi">18</span> <span class="n">spltp</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">bw_method</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span> <span class="c1"># store data</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="n">unfolded_data</span> <span class="o">=</span> <span class="n">spltp</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xydata</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;p&#39; is not defined
</pre></div>
</div>
<img alt="../_images/exploring-raga_88_1.png" src="../_images/exploring-raga_88_1.png" />
</div>
</div>
<p>Force to one octave</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="o">%</span><span class="k">1200</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">48</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="o">%</span><span class="k">1200</span>

<span class="ne">NameError</span>: name &#39;p&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># One octave... shouldn&#39;t need to specify</span>
<span class="c1"># plot setup</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;#f2f2f2&#39;</span><span class="p">)</span>

<span class="c1"># turn off y ticks</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([],</span> <span class="p">[])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pitch (cents)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1200</span><span class="p">))</span>

<span class="n">spltp1</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">bw_method</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">49</span><span class="p">],</span> <span class="n">line</span> <span class="mi">17</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pitch (cents)&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1200</span><span class="p">))</span>
<span class="ne">---&gt; </span><span class="mi">17</span> <span class="n">spltp1</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">bw_method</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;p1&#39; is not defined
</pre></div>
</div>
<img alt="../_images/exploring-raga_91_1.png" src="../_images/exploring-raga_91_1.png" />
</div>
</div>
<p>Add svara theoretical pitch positions</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">svara_pitch_cents</span> <span class="o">=</span> <span class="n">get_svara_pitch_carnatic</span><span class="p">(</span><span class="s1">&#39;ritigaula&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># One octave... shouldn&#39;t need to specify</span>
<span class="c1"># plot setup</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;#f2f2f2&#39;</span><span class="p">)</span>

<span class="c1"># turn off y ticks</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([],</span> <span class="p">[])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pitch (cents)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1200</span><span class="p">))</span>

<span class="n">spltp1</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">bw_method</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span>

<span class="c1"># Get max value in y</span>
<span class="n">y_max</span> <span class="o">=</span> <span class="n">spltp1</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">svara_pitch_cents</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="c1"># just svaras for this octave</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="mi">1200</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;firebrick&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">-</span> <span class="n">y_max</span><span class="o">*</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;firebrick&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">51</span><span class="p">],</span> <span class="n">line</span> <span class="mi">17</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pitch (cents)&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1200</span><span class="p">))</span>
<span class="ne">---&gt; </span><span class="mi">17</span> <span class="n">spltp1</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">bw_method</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span> <span class="c1"># Get max value in y</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">spltp1</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;p1&#39; is not defined
</pre></div>
</div>
<img alt="../_images/exploring-raga_94_1.png" src="../_images/exploring-raga_94_1.png" />
</div>
</div>
<p>Looks good right? Any problems?</p>
<p>There are two peaks for Sa, neither correponding exactly to the tonic (0 cents). This is unexpected. When we look at the pitch plot computed across all octaves we do not see two peaks for Sa!</p>
<p>This is not an error, everything is functioning as it should do. But in aggregating the individual kernel functions (the bumps), each peak is effected by all bumps in it’s neighbourhood, in the unfolded plot the Sa peak has a neighbourhood to it’s left and to it’s right. In the folded plot it only has a neighbourhood to one side depending on whether we are looking at pitch=0, pitch=1200. If we look at the KDE, histogram comparison figure again we can see this</p>
<div>
<figure>
<img src="../images/KDE.png" width="500"/>
</figure>
</div>
<p>Pick a y value corresponding to a peak and imagine the line x=(this y value). You should see that red kernel functions from both sides of this line contribute to the aggregated density estimation (blue line). This is not the case when all data points on one side of the line are removed (such as is the case for when folding pitch values to one octave).</p>
</section>
<section id="fixing-tonic-errors-in-folded-plots">
<h4>Fixing tonic errors in folded plots<a class="headerlink" href="#fixing-tonic-errors-in-folded-plots" title="Permalink to this headline">#</a></h4>
<p>To fix this issue we must compute the pitch density plot across all octaves and <em>then</em> aggregate. Let’s take the data from our unfolded plot</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">unfolded_data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">unfolded_data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">52</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">unfolded_data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">unfolded_data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>

<span class="ne">NameError</span>: name &#39;unfolded_data&#39; is not defined
</pre></div>
</div>
<img alt="../_images/exploring-raga_102_1.png" src="../_images/exploring-raga_102_1.png" />
</div>
</div>
<p>And now split plot into three sections, one for each octave</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_sep</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="c1"># Divide cent data into ocataves</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">2400</span><span class="p">,</span> <span class="mi">2400</span><span class="p">,</span> <span class="mi">1200</span><span class="p">):</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">unfolded_data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">unfolded_data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">i</span><span class="o">+</span><span class="mi">1200</span><span class="p">)</span>
    <span class="n">this_data</span> <span class="o">=</span> <span class="n">unfolded_data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">this_data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">this_data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">data_sep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">53</span><span class="p">],</span> <span class="n">line</span> <span class="mi">6</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># Divide cent data into ocataves</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">2400</span><span class="p">,</span> <span class="mi">2400</span><span class="p">,</span> <span class="mi">1200</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">6</span>     <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">unfolded_data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">unfolded_data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">i</span><span class="o">+</span><span class="mi">1200</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">this_data</span> <span class="o">=</span> <span class="n">unfolded_data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">this_data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">this_data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>

<span class="ne">NameError</span>: name &#39;unfolded_data&#39; is not defined
</pre></div>
</div>
<img alt="../_images/exploring-raga_104_1.png" src="../_images/exploring-raga_104_1.png" />
</div>
</div>
<p>Force each section to the 0cents -&gt; 1200cents octave</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Force to same octave</span>
<span class="n">data_octave</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data_sep</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">%</span><span class="k">1200</span> # force to same octave
        <span class="n">data_octave</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/exploring-raga_106_0.png" src="../_images/exploring-raga_106_0.png" />
</div>
</div>
<p>Since each of these lines do not necessarily terminate at exactly 0 and 1200. If we sum them we will observe big discrepancies in pitch towards these limits:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sum distributions using interpolation</span>
<span class="k">def</span> <span class="nf">sum_dist</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sum two distributions, &lt;d1&gt; and &lt;d2&gt; along y axis</span>
<span class="sd">    </span>
<span class="sd">    :param d1,d2: numpy array of form [(x, y),...</span>
<span class="sd">    :type d1,d2: np.array</span>
<span class="sd">    </span>
<span class="sd">    :returns: one array with y values summed</span>
<span class="sd">    :rtype: np.array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">d1</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">d2</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">d2</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">d1</span>
    <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">d1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">d2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Arrays must have two columns&quot;</span><span class="p">)</span>
        
    <span class="n">x1</span> <span class="o">=</span> <span class="n">d1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">d1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">x2</span> <span class="o">=</span> <span class="n">d2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">d2</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># get a sorted list of all x values</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">)))</span>

    <span class="c1"># interpolate y1 and y2 on the combined x values</span>
    <span class="n">yi1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">yi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="n">y</span> <span class="o">=</span> <span class="n">yi1</span> <span class="o">+</span> <span class="n">yi2</span>
        
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">summed_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data_sep</span><span class="p">:</span>
    <span class="n">summed_d</span> <span class="o">=</span> <span class="n">sum_dist</span><span class="p">(</span><span class="n">summed_d</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">summed_d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">summed_d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f71585cad00&gt;]
</pre></div>
</div>
<img alt="../_images/exploring-raga_110_1.png" src="../_images/exploring-raga_110_1.png" />
</div>
</div>
<p>To avoid this we must ensure that each series terminates at exactly 0 and 1200 cents</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">lstsq</span>

<span class="k">def</span> <span class="nf">line_through_points</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return two functions corresponding to straight line learnt </span>
<span class="sd">    via least squares regression between two points (x0,y0)</span>
<span class="sd">    and (x1, y1). These functions retrieve x and y values </span>
<span class="sd">    from that line.</span>
<span class="sd">    </span>
<span class="sd">    :param x0,y0,x1,y1: coordinates values corresponding to two points</span>
<span class="sd">    :type x0,y0,x1,y1: float</span>

<span class="sd">    :returns: Two lambda functions, get_x and get_y that takes as a value, y or x</span>
<span class="sd">        respectively and returns x or y values along learnt line</span>
<span class="sd">    :rtype: two python functions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">points</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)]</span>
    <span class="n">x_coords</span><span class="p">,</span> <span class="n">y_coords</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">points</span><span class="p">)</span>
    
    <span class="c1"># gradient and intercecpt of line passing through centroids</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">x_coords</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_coords</span><span class="p">))])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">lstsq</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">y_coords</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># functions for converting between</span>
    <span class="c1"># x and y on that line</span>
    <span class="n">get_y</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">xin</span><span class="p">:</span> <span class="n">m</span><span class="o">*</span><span class="n">xin</span> <span class="o">+</span> <span class="n">c</span>
    <span class="n">get_x</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">yin</span><span class="p">:</span> <span class="p">(</span><span class="n">yin</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="n">m</span>

    <span class="k">return</span> <span class="n">get_x</span><span class="p">,</span> <span class="n">get_y</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#extend to same start and end point</span>
<span class="n">data_extended</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data_octave</span><span class="p">:</span>
    <span class="c1"># line through first 5 points</span>
    <span class="n">first_point</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">second_point</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">getx_min</span><span class="p">,</span> <span class="n">gety_min</span> <span class="o">=</span> <span class="n">line_through_points</span><span class="p">(</span>
        <span class="n">first_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">first_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">second_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">second_point</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># line through final 5 points</span>
    <span class="n">final_point</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">penultimate_point</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span>
    <span class="n">gety_max</span><span class="p">,</span> <span class="n">gety_max</span> <span class="o">=</span> <span class="n">line_through_points</span><span class="p">(</span>
        <span class="n">final_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">final_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">penultimate_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">penultimate_point</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># new point at x=0</span>
    <span class="n">new_point1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">gety_min</span><span class="p">(</span><span class="mi">0</span><span class="p">)])</span>

    <span class="c1"># new point at x=1200</span>
    <span class="n">new_point2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1200</span><span class="p">,</span> <span class="n">gety_max</span><span class="p">(</span><span class="mi">1200</span><span class="p">)])</span>

    <span class="c1"># append at beginning</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">new_point1</span><span class="p">],</span> <span class="n">d</span><span class="p">])</span>
    <span class="c1"># append at end</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">d</span><span class="p">,</span> <span class="p">[</span><span class="n">new_point2</span><span class="p">]])</span>

    <span class="n">data_extended</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>        
</pre></div>
</div>
</div>
</div>
<p>Overlaid extended lines…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data_extended</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/exploring-raga_115_0.png" src="../_images/exploring-raga_115_0.png" />
</div>
</div>
<p>Summing all together</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">summed_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data_extended</span><span class="p">:</span>
    <span class="n">summed_d</span> <span class="o">=</span> <span class="n">sum_dist</span><span class="p">(</span><span class="n">summed_d</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And finally we must normalise so the area under the curve sums to one</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># normalise area under curve to equal 1</span>
<span class="n">summed_d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">/=</span> <span class="n">summed_d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">summed_d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">summed_d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f71584d14c0&gt;]
</pre></div>
</div>
<img alt="../_images/exploring-raga_120_1.png" src="../_images/exploring-raga_120_1.png" />
</div>
</div>
<p>An implementation for this folded and unfolded pitch density computation is provided at <code class="docutils literal notranslate"><span class="pre">compiam.visualisation.pitch.get_pitch_density</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flush_matplotlib</span><span class="p">()</span> <span class="c1"># clear all background plots</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 640x480 with 0 Axes&gt;
</pre></div>
</div>
</div>
</div>
</section>
<section id="extraction-across-the-datastet">
<h4>Extraction across the datastet<a class="headerlink" href="#extraction-across-the-datastet" title="Permalink to this headline">#</a></h4>
<p>Now that we are able to compute reliable pitch density plots let’s explore pitch density across a sample of the dataset.</p>
<p>For all performances across a sample of ragas in the Saraga dataset we:</p>
<ol class="simple">
<li><p>Compute the predominant pitch tracks extracted using the Carnatic FTA-Net model</p></li>
<li><p>Convert pitch track to cents using <code class="docutils literal notranslate"><span class="pre">compiam.utils.pitch.pitch_seq_to_cents()</span></code> using the tonic provided as part of the saraga dataset. If the tonic is not present we use <code class="docutils literal notranslate"><span class="pre">compiam.melody.tonic_identification()</span></code> to predict it.</p></li>
<li><p>Combine all pitch tracks corresponding to each raga</p></li>
<li><p>Get svara:cents mappings for each raga using <code class="docutils literal notranslate"><span class="pre">compiam.utils.get_svara_pitch_carnatic()</span></code></p></li>
<li><p>Get and compute the pitch histogram using <code class="docutils literal notranslate"><span class="pre">compiam.visualisation.pitch.get_pitch_density()</span></code>. (Setting <code class="docutils literal notranslate"><span class="pre">octave=True</span></code> forces all pitches to the same octave). Overlay theoretical pitch positions of svaras relevant to each raga and display all plots.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">compiam.visualisation.pitch</span> <span class="kn">import</span> <span class="n">get_pitch_density</span>
<span class="kn">from</span> <span class="nn">compiam.utils.pitch</span> <span class="kn">import</span> <span class="n">pitch_seq_to_cents</span>
<span class="kn">from</span> <span class="nn">compiam.melody</span> <span class="kn">import</span> <span class="n">tonic_identification</span>
<span class="kn">from</span> <span class="nn">compiam.utils</span> <span class="kn">import</span> <span class="n">get_svara_pitch_carnatic</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tqdm</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s define some basic functions for getting and processing the data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">compiam.utils</span> <span class="kn">import</span> <span class="n">create_if_not_exists</span>

<span class="k">def</span> <span class="nf">get_audio_path</span><span class="p">(</span><span class="n">track_id</span><span class="p">,</span> <span class="n">track_data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For saraga &lt;track_id&gt;, return path of vocal source.</span>
<span class="sd">    If isolated vocal source does not exist for track,</span>
<span class="sd">    return path to mixed audio.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">track_data</span><span class="p">[</span><span class="n">track_id</span><span class="p">]</span>
    
    <span class="n">vocal_path</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">audio_vocal_path</span>
    <span class="n">audio_path</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">audio_path</span>
    
    <span class="k">return</span> <span class="n">audio_path</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">vocal_path</span> <span class="k">else</span> <span class="n">vocal_path</span>

<span class="k">def</span> <span class="nf">extract_pitch_track</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract predominant pitch track of audio at</span>
<span class="sd">    &lt;path&gt;. Return pitch, time and timestep</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pitch_track</span> <span class="o">=</span> <span class="n">ftanet</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">pitch</span> <span class="o">=</span> <span class="n">pitch_track</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">time</span>  <span class="o">=</span> <span class="n">pitch_track</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">timestep</span>  <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">time</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">timestep</span>

<span class="k">def</span> <span class="nf">save_pitch_track</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save pitch track as tsv to &lt;path&gt;</span>
<span class="sd">    format: (time, pitch)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">create_if_not_exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">pitch</span><span class="p">):</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">load_pitch_track</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load pitch track from tsv to</span>
<span class="sd">    format: (time, pitch)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pitch</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">time</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">t</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/n&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">pitch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
            <span class="n">time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">timestep</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">time</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pitch</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">time</span><span class="p">),</span> <span class="n">timestep</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="extracting-predominant-pitch-tracks">
<h4>Extracting predominant pitch tracks<a class="headerlink" href="#extracting-predominant-pitch-tracks" title="Permalink to this headline">#</a></h4>
<p>We extract the predominant pitch track for a sample of popular ragas. Each is a raga for which we have more than one recording in the Saraga Dataset.</p>
<p><font color='red'><strong>Warning!</strong></font> The following snippet as it stands can take a lot of time (extracting pitch tracks for ~30 tracks). Changing the number of ragas in <code class="docutils literal notranslate"><span class="pre">sample_raga</span></code> will affect this. For the online notebook the lines <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">Extract</span> <span class="pre">pitch</span> <span class="pre">track</span></code> and <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">Save</span> <span class="pre">locally</span></code> are commented out and the results cached beforehand. Remember to uncomment these lines if you want to extract these yourself or include different ragas/tracks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># sample of most common abundant ragas in Saraga Dataset</span>
<span class="n">sample_ragas</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Tōḍi&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Kamās&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Saurāṣtraṁ&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Bhairavi&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Rītigauḷa&#39;</span>
<span class="p">]</span>

<span class="c1"># Save pitch tracks to local directory</span>
<span class="n">pitch_dir</span> <span class="o">=</span> <span class="s1">&#39;./pitch_data/&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># dict of data relating to each raga</span>
<span class="n">raga_track</span> <span class="o">=</span> <span class="p">{</span><span class="n">r</span><span class="p">:{</span><span class="s2">&quot;pitch_paths&quot;</span><span class="p">:[],</span><span class="s2">&quot;tonics&quot;</span><span class="p">:[],</span><span class="s2">&quot;names&quot;</span><span class="p">:[],</span><span class="s2">&quot;track_ids&quot;</span><span class="p">:[]}</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">sample_ragas</span><span class="p">}</span>

<span class="c1"># Iterate through track data, extract pitch track, save locally</span>
<span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">track_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    
    <span class="n">raga</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;raaga&quot;</span><span class="p">]</span>   
    <span class="k">if</span> <span class="n">raga</span><span class="p">:</span>
        <span class="c1"># raga annotation is sometimes None</span>
        <span class="n">raga</span> <span class="o">=</span> <span class="n">raga</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        
    <span class="k">if</span> <span class="n">raga</span> <span class="ow">in</span> <span class="n">sample_ragas</span><span class="p">:</span>
        <span class="c1"># Get audio path</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">get_audio_path</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">track_data</span><span class="p">)</span>
    
        <span class="c1"># Extract pitch track</span>
        <span class="c1">#pitch, time, timestep = extract_pitch_track(path)</span>
        
        <span class="c1"># Save locally</span>
        <span class="n">out_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pitch_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
        <span class="c1">#save_pitch_track(time, pitch, out_path)</span>

        <span class="c1"># Metadata</span>
        <span class="n">artist</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;album_artists&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
        <span class="n">tonic</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">tonic</span>
        
        <span class="c1"># Update Dict</span>
        <span class="n">raga_track</span><span class="p">[</span><span class="n">raga</span><span class="p">][</span><span class="s2">&quot;track_ids&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">raga_track</span><span class="p">[</span><span class="n">raga</span><span class="p">][</span><span class="s2">&quot;pitch_paths&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">out_path</span><span class="p">]</span>
        <span class="n">raga_track</span><span class="p">[</span><span class="n">raga</span><span class="p">][</span><span class="s2">&quot;tonics&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">tonic</span><span class="p">]</span>
        <span class="n">raga_track</span><span class="p">[</span><span class="n">raga</span><span class="p">][</span><span class="s2">&quot;names&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">artist</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">68</span><span class="p">],</span> <span class="n">line</span> <span class="mi">9</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="c1"># Iterate through track data, extract pitch track, save locally</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">track_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="ne">----&gt; </span><span class="mi">9</span>     <span class="n">raga</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;raaga&quot;</span><span class="p">]</span>   
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="k">if</span> <span class="n">raga</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>         <span class="c1"># raga annotation is sometimes None</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>         <span class="n">raga</span> <span class="o">=</span> <span class="n">raga</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/mirdata/core.py:46,</span> in <span class="ni">cached_property.__get__</span><span class="nt">(self, obj, cls)</span>
<span class="g g-Whitespace">     </span><span class="mi">44</span> <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">45</span>     <span class="k">return</span> <span class="bp">self</span>
<span class="ne">---&gt; </span><span class="mi">46</span> <span class="n">value</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span> <span class="k">return</span> <span class="n">value</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/mirdata/datasets/saraga_carnatic.py:150,</span> in <span class="ni">Track.metadata</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">148</span> <span class="nd">@core</span><span class="o">.</span><span class="n">cached_property</span>
<span class="g g-Whitespace">    </span><span class="mi">149</span> <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">150</span>     <span class="k">return</span> <span class="n">load_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_path</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/mirdata/io.py:22,</span> in <span class="ni">coerce_to_string_io.&lt;locals&gt;.wrapper</span><span class="nt">(file_path_or_obj)</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>     <span class="k">return</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_path_or_obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">22</span>     <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path_or_obj</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span>         <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_path_or_obj</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">):</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/smart_open/smart_open_lib.py:177,</span> in <span class="ni">open</span><span class="nt">(uri, mode, buffering, encoding, errors, newline, closefd, opener, compression, transport_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">174</span> <span class="k">if</span> <span class="n">transport_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">175</span>     <span class="n">transport_params</span> <span class="o">=</span> <span class="p">{}</span>
<span class="ne">--&gt; </span><span class="mi">177</span> <span class="n">fobj</span> <span class="o">=</span> <span class="n">_shortcut_open</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">178</span>     <span class="n">uri</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">179</span>     <span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">180</span>     <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">181</span>     <span class="n">buffering</span><span class="o">=</span><span class="n">buffering</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">182</span>     <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">183</span>     <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">184</span>     <span class="n">newline</span><span class="o">=</span><span class="n">newline</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">185</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">186</span> <span class="k">if</span> <span class="n">fobj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">187</span>     <span class="k">return</span> <span class="n">fobj</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/smart_open/smart_open_lib.py:363,</span> in <span class="ni">_shortcut_open</span><span class="nt">(uri, mode, compression, buffering, encoding, errors, newline)</span>
<span class="g g-Whitespace">    </span><span class="mi">360</span> <span class="k">if</span> <span class="n">errors</span> <span class="ow">and</span> <span class="s1">&#39;b&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">361</span>     <span class="n">open_kwargs</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors</span>
<span class="ne">--&gt; </span><span class="mi">363</span> <span class="k">return</span> <span class="n">_builtin_open</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">buffering</span><span class="o">=</span><span class="n">buffering</span><span class="p">,</span> <span class="o">**</span><span class="n">open_kwargs</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;../data/saraga1.5_carnatic/saraga1.5_carnatic/Sumitra Nitin at Arkay by Sumitra Nitin/Dorakuna/Dorakuna.json&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="id1">
<h4>Pitch density extraction<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># map saraga names to names in local dictionary</span>
<span class="n">raga_norm</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Tōḍi&quot;</span><span class="p">:</span> <span class="s2">&quot;todi&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;Kamās&quot;</span><span class="p">:</span> <span class="s2">&quot;kamas&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;Saurāṣtraṁ&quot;</span><span class="p">:</span> <span class="s2">&quot;saurastram&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;Bhairavi&quot;</span><span class="p">:</span> <span class="s2">&quot;bhairavi&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;Rītigauḷa&quot;</span><span class="p">:</span> <span class="s2">&quot;ritigaula&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pitch_hists</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># dict to store histogram data</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">raga_track</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing: </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># get performances for rāga</span>
    <span class="n">pitch_paths</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;pitch_paths&quot;</span><span class="p">]</span>
    <span class="n">tonics</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;tonics&quot;</span><span class="p">]</span>
    <span class="n">names</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]</span>
    <span class="n">track_ids</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;track_ids&quot;</span><span class="p">]</span>
    <span class="n">normalised_name</span> <span class="o">=</span> <span class="n">raga_norm</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
    
    <span class="c1"># number of examples</span>
    <span class="n">nr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pitch_paths</span><span class="p">)</span>
    
    <span class="n">all_pitch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">all_hists</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pitch_paths</span><span class="p">)):</span>
        <span class="n">pitch_path</span> <span class="o">=</span> <span class="n">pitch_paths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">tonic</span> <span class="o">=</span> <span class="n">tonics</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">track_id</span> <span class="o">=</span> <span class="n">track_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        
        <span class="c1"># 1. Load precomputed pitch track</span>
        <span class="n">pitch</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">timestep</span> <span class="o">=</span> <span class="n">load_pitch_track</span><span class="p">(</span><span class="n">pitch_path</span><span class="p">)</span>
        
        <span class="c1"># 2. Convert to cents</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tonic</span><span class="p">:</span>
            <span class="n">tonicExt</span> <span class="o">=</span> <span class="n">tonic_identification</span><span class="o">.</span><span class="n">TonicIndianMultiPitch</span><span class="p">()</span>
            <span class="n">tonic</span> <span class="o">=</span> <span class="n">tonicExt</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">pitch</span><span class="p">)</span>
         
        <span class="n">pitch_cents</span> <span class="o">=</span> <span class="n">pitch_seq_to_cents</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="n">tonic</span><span class="o">=</span><span class="n">tonic</span><span class="p">)</span>
        
        <span class="c1"># 3. combine pitch tracks</span>
        <span class="n">all_pitch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">all_pitch</span><span class="p">,</span> <span class="n">pitch_cents</span><span class="p">])</span>
        
        <span class="c1"># 4. Get svara:cents mapping</span>
        <span class="n">svara_map</span> <span class="o">=</span> <span class="n">get_svara_pitch_carnatic</span><span class="p">(</span><span class="n">normalised_name</span><span class="p">)</span>
        
        <span class="c1"># 5. Compute pitch histograms</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="n">get_pitch_density</span><span class="p">(</span><span class="n">pitch_cents</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">name</span><span class="o">+</span><span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">bw</span><span class="o">=</span><span class="mf">0.035</span><span class="p">,</span> <span class="n">annotations</span><span class="o">=</span><span class="n">svara_map</span><span class="p">,</span> <span class="n">octave</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">imode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="c1"># store individual pitch histograms</span>
        <span class="n">all_hists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
        
        <span class="n">flush_matplotlib</span><span class="p">()</span>
    
    <span class="c1"># Store combined pitch histograms</span>
    <span class="n">ph</span> <span class="o">=</span> <span class="n">get_pitch_density</span><span class="p">(</span><span class="n">all_pitch</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s1"> from </span><span class="si">{</span><span class="n">nr</span><span class="si">}</span><span class="s1"> performances&#39;</span><span class="p">,</span> <span class="n">bw</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">annotations</span><span class="o">=</span><span class="n">svara_map</span><span class="p">,</span> <span class="n">octave</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">imode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">all_hists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
    <span class="n">flush_matplotlib</span><span class="p">()</span>
    <span class="n">pitch_hists</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_hists</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Processing: Tōḍi
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">71</span><span class="p">],</span> <span class="n">line</span> <span class="mi">46</span>
<span class="g g-Whitespace">     </span><span class="mi">43</span>     <span class="n">flush_matplotlib</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">45</span> <span class="c1"># Store combined pitch histograms</span>
<span class="ne">---&gt; </span><span class="mi">46</span> <span class="n">ph</span> <span class="o">=</span> <span class="n">get_pitch_density</span><span class="p">(</span><span class="n">all_pitch</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s1"> from </span><span class="si">{</span><span class="n">nr</span><span class="si">}</span><span class="s1"> performances&#39;</span><span class="p">,</span> <span class="n">bw</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">annotations</span><span class="o">=</span><span class="n">svara_map</span><span class="p">,</span> <span class="n">octave</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">imode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span> <span class="n">all_hists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span> <span class="n">flush_matplotlib</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;svara_map&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Write all pitch histograms to folder (replace <code class="docutils literal notranslate"><span class="pre">&lt;out_dir&gt;</span></code>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="kc">False</span><span class="p">:</span> <span class="c1"># skipping for now</span>
    <span class="n">out_dir</span> <span class="o">=</span> <span class="s1">&#39;&lt;out_dir&gt;&#39;</span>

    <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">plots</span> <span class="ow">in</span> <span class="n">pitch_hists</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">plots</span><span class="p">):</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">plots</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">out_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">_combined.png&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
            <span class="n">create_if_not_exists</span><span class="p">(</span><span class="n">out_path</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Saving, </span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">out_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><a id='3.5'></a></p>
</section>
</section>
<section id="pitch-density-across-raga">
<h3>3.5 Pitch density across rāga<a class="headerlink" href="#pitch-density-across-raga" title="Permalink to this headline">#</a></h3>
<p>Let’s take a moment to consider some of these results. Rāga rītigauḷa and bhairavi share many of the same svaras…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ritigaula_svaras</span> <span class="o">=</span> <span class="n">get_svara_pitch_carnatic</span><span class="p">(</span><span class="s2">&quot;ritigaula&quot;</span><span class="p">)</span> <span class="c1"># svaras for ritigaula</span>
<span class="n">bhairavi_svaras</span> <span class="o">=</span> <span class="n">get_svara_pitch_carnatic</span><span class="p">(</span><span class="s2">&quot;bhairavi&quot;</span><span class="p">)</span> <span class="c1"># svaras for bhairavi</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rītigauḷa: </span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">ritigaula_svaras</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bhairavi: </span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">bhairavi_svaras</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Rītigauḷa: {&#39;M1&#39;, &#39;N2&#39;, &#39;G2&#39;, &#39;D2&#39;, &#39;S&#39;, &#39;R2&#39;, &#39;P&#39;}
Bhairavi: {&#39;M1&#39;, &#39;D1&#39;, &#39;N2&#39;, &#39;G2&#39;, &#39;D2&#39;, &#39;S&#39;, &#39;R2&#39;, &#39;P&#39;}
</pre></div>
</div>
</div>
</div>
<p>We expect our pitch histograms to corroborate this…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ritigaula</span> <span class="o">=</span> <span class="n">pitch_hists</span><span class="p">[</span><span class="s2">&quot;Rītigauḷa&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">bhairavi</span> <span class="o">=</span> <span class="n">pitch_hists</span><span class="p">[</span><span class="s2">&quot;Bhairavi&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">74</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ritigaula</span> <span class="o">=</span> <span class="n">pitch_hists</span><span class="p">[</span><span class="s2">&quot;Rītigauḷa&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">bhairavi</span> <span class="o">=</span> <span class="n">pitch_hists</span><span class="p">[</span><span class="s2">&quot;Bhairavi&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="ne">KeyError</span>: &#39;Rītigauḷa&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ritigaula</span><span class="o">.</span><span class="n">figure</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">75</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ritigaula</span><span class="o">.</span><span class="n">figure</span>

<span class="ne">NameError</span>: name &#39;ritigaula&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bhairavi</span><span class="o">.</span><span class="n">figure</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">76</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">bhairavi</span><span class="o">.</span><span class="n">figure</span>

<span class="ne">NameError</span>: name &#39;bhairavi&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>There are several interesting differences to note in this comparison. The two rāgas share mostly the same svaras, apart from the fact that in these versions of rītigauḷa (although not all versions) there is no D1, while in bhairavi D1 is there.
We can see from these two combined plots that ri is stronger in bhairavi than in rītigauḷa, which indeed reflects typical performance practice. In addition, we can see a small but clear peak for N2 in rītigauḷa that is not present in bhairavi. This is most likely because rītigauḷa includes a frequently performed characteristic phrase in which a relatively plain ni features strongly, while in bhairavi, ni is much more frequently performed as an oscillation between dha and sa.</p>
<p>Again it is worth iterating here that the pitch positions shown as red dotted lines together with the svara indications S, R2, G2 etc., are only indicative of positions on an equal tempered scale and that Carnatic music does not use the equal tempered scale. Therefore, any deviation here from those dotted lines does not indicate an error in intonation, but more likely reflects correct musical practice in the style or slight errors in the automated calculation of the tonic.
<a id='3.6'></a></p>
</section>
<section id="pitch-density-as-a-feature">
<h3>3.6 Pitch density as a feature<a class="headerlink" href="#pitch-density-as-a-feature" title="Permalink to this headline">#</a></h3>
<p>The form of the pitch histogram gives us a sort of pitch fingerprint of the rāga or performance it describes. Since they are normalised in the y-dimension (density plots) and in the x-dimension (cents), comparison between them is easy, regardless of how many performances have contributed to their creation.</p>
<p>We compute the distance between each pairwise combination of performance pitch histogram, using cross entropy (other measures are perfectly valid!).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dist_measure</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">measure</span><span class="o">=</span><span class="k">lambda</span> <span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">:</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y2</span><span class="p">))):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute measure between distributions d1 and d2 using &lt;measure&gt;. </span>
<span class="sd">    Default: cross entropy</span>
<span class="sd">    </span>
<span class="sd">    :param d1, d2: distributions of form [(x,y),..</span>
<span class="sd">    :param d1, d2: np.array</span>
<span class="sd">    :param measure: function that takes two distributions y-values and returns some measure, metric or distance</span>
<span class="sd">    :param measure: python function</span>
<span class="sd">    </span>
<span class="sd">    :returns: value, from &lt;measure&gt;</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure distributions have same x values</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">d1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">d1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">x2</span> <span class="o">=</span> <span class="n">d2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">d2</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># get a sorted list of all x values</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">)))</span>

    <span class="c1"># interpolate y1 and y2 on the combined x values</span>
    <span class="n">yi1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">yi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># downsample</span>
    <span class="n">yi1</span> <span class="o">=</span> <span class="n">yi1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">yi1</span><span class="o">.</span><span class="n">size</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">yi2</span> <span class="o">=</span> <span class="n">yi2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">yi2</span><span class="o">.</span><span class="n">size</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">measure</span><span class="p">(</span><span class="n">yi1</span><span class="p">,</span> <span class="n">yi2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get unique performance names</span>
<span class="n">performance_names</span> <span class="o">=</span> <span class="p">[[</span><span class="n">h</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hists</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">hists</span> <span class="ow">in</span> <span class="n">pitch_hists</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span> 
<span class="n">performance_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">performance_names</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>

<span class="c1"># get individual performance histograms</span>
<span class="n">performance_histograms</span> <span class="o">=</span> <span class="p">[[</span><span class="n">h</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hists</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">hists</span> <span class="ow">in</span> <span class="n">pitch_hists</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
<span class="n">performance_histograms</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">performance_histograms</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>

<span class="c1"># get data corresponding to y-axis</span>
<span class="n">performance_hist_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xydata</span><span class="p">()</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">performance_histograms</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># iterate through all performances and compute pairwise distance</span>
<span class="c1"># updating distance matrix</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">performance_names</span><span class="p">)</span>
<span class="n">performance_dist_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">performance_dist_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist_measure</span><span class="p">(</span><span class="n">performance_hist_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">performance_hist_data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">performance_dist_matrix</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">performance_dist_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> 
</pre></div>
</div>
</div>
</div>
<p><a id='3.7'></a></p>
</section>
<section id="performance-clustering">
<h3>3.7 Performance clustering<a class="headerlink" href="#performance-clustering" title="Permalink to this headline">#</a></h3>
<p>In fact, we can take a naive look at to what extent svara realization is able to distinguish between rāgas using the information captured by the pitch density plots.</p>
<p>Let’s apply a hierarchical clustering algorithm using the pairwise cross entropy distances between performances as the affinity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">AgglomerativeClustering</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">AgglomerativeClustering</span><span class="p">(</span><span class="n">affinity</span><span class="o">=</span><span class="s1">&#39;precomputed&#39;</span><span class="p">,</span> <span class="n">n_clusters</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_ragas</span><span class="p">),</span> <span class="n">linkage</span><span class="o">=</span><span class="s1">&#39;complete&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">performance_dist_matrix</span><span class="p">)</span>
<span class="n">results_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_ragas</span><span class="p">))}</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">labels_</span><span class="p">):</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. &quot;</span><span class="o">+</span><span class="n">performance_names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">80</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">AgglomerativeClustering</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">model</span> <span class="o">=</span> <span class="n">AgglomerativeClustering</span><span class="p">(</span><span class="n">affinity</span><span class="o">=</span><span class="s1">&#39;precomputed&#39;</span><span class="p">,</span> <span class="n">n_clusters</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_ragas</span><span class="p">),</span> <span class="n">linkage</span><span class="o">=</span><span class="s1">&#39;complete&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">performance_dist_matrix</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_ragas</span><span class="p">))}</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">labels_</span><span class="p">):</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/sklearn/cluster/_agglomerative.py:955,</span> in <span class="ni">AgglomerativeClustering.fit</span><span class="nt">(self, X, y)</span>
<span class="g g-Whitespace">    </span><span class="mi">937</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Fit the hierarchical clustering from features, or distance matrix.</span>
<span class="g g-Whitespace">    </span><span class="mi">938</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">939</span><span class="sd"> Parameters</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">952</span><span class="sd">     Returns the fitted instance.</span>
<span class="g g-Whitespace">    </span><span class="mi">953</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">954</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_params</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">955</span> <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_data</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">ensure_min_samples</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">956</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/sklearn/base.py:565,</span> in <span class="ni">BaseEstimator._validate_data</span><span class="nt">(self, X, y, reset, validate_separately, **check_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">563</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Validation should be done on X, y or both.&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">564</span> <span class="k">elif</span> <span class="ow">not</span> <span class="n">no_val_X</span> <span class="ow">and</span> <span class="n">no_val_y</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">565</span>     <span class="n">X</span> <span class="o">=</span> <span class="n">check_array</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">input_name</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">check_params</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">566</span>     <span class="n">out</span> <span class="o">=</span> <span class="n">X</span>
<span class="g g-Whitespace">    </span><span class="mi">567</span> <span class="k">elif</span> <span class="n">no_val_X</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">no_val_y</span><span class="p">:</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/sklearn/utils/validation.py:931,</span> in <span class="ni">check_array</span><span class="nt">(array, accept_sparse, accept_large_sparse, dtype, order, copy, force_all_finite, ensure_2d, allow_nd, ensure_min_samples, ensure_min_features, estimator, input_name)</span>
<span class="g g-Whitespace">    </span><span class="mi">929</span>     <span class="n">n_samples</span> <span class="o">=</span> <span class="n">_num_samples</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">930</span>     <span class="k">if</span> <span class="n">n_samples</span> <span class="o">&lt;</span> <span class="n">ensure_min_samples</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">931</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">932</span>             <span class="s2">&quot;Found array with </span><span class="si">%d</span><span class="s2"> sample(s) (shape=</span><span class="si">%s</span><span class="s2">) while a&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">933</span>             <span class="s2">&quot; minimum of </span><span class="si">%d</span><span class="s2"> is required</span><span class="si">%s</span><span class="s2">.&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">934</span>             <span class="o">%</span> <span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">ensure_min_samples</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">935</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">937</span> <span class="k">if</span> <span class="n">ensure_min_features</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">938</span>     <span class="n">n_features</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="ne">ValueError</span>: Found array with 0 sample(s) (shape=(0, 0)) while a minimum of 2 is required by AgglomerativeClustering.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">perfs</span> <span class="ow">in</span> <span class="n">results_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Group </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">perfs</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">81</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">perfs</span> <span class="ow">in</span> <span class="n">results_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Group </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">perfs</span><span class="p">:</span>

<span class="ne">NameError</span>: name &#39;results_dict&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>We can see from these groupings that pitch is helpful, but not sufficient for differentiating rāgas. This is something that musicians know well. To better understand rāga performance we need to look also at the motif and phrase level, that is to say, the melody.
<a id='4'></a></p>
</section>
</section>
<section id="melodic-pattern-analysis">
<h2>4. Melodic pattern analysis<a class="headerlink" href="#melodic-pattern-analysis" title="Permalink to this headline">#</a></h2>
<p>Another important feature of the style is the structural and expressive significance of motifs and phrases known as sañcāras, which can be defined as coherent segments of melodic movement that follow the grammar of the rāga [4, 11]. These melodic patterns are the means through which the character of the rāga is expressed and form the basis of various improvisatory and compositional formats in the style [5, 11]. There exists no definitive lists of all possible sañcāras in each rāga, rather the body of existing compositions and the living oral tradition of rāga performance act as repositories for that knowledge [12].</p>
<p>Certain characteristics of Carnatic Music (some of which it shares with many traditions around the world) make the task of identifying repeated motifs and phrases in Carnatic music performances particuarly difficult, particularly in how certain motifs and phrases are often performed across occurrences with variations in tempo, pitch and ornamentation.</p>
<p>We return to Koti Janmani for the pattern analysis</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track_id</span> <span class="o">=</span> <span class="s1">&#39;47_Koti_Janmani&#39;</span> 
<span class="n">track</span> <span class="o">=</span> <span class="n">track_data</span><span class="p">[</span><span class="n">track_id</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">audio_path</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">audio_vocal_path</span>
<span class="n">tonic</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">tonic</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">83</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">audio_path</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">audio_vocal_path</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">tonic</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">tonic</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/mirdata/core.py:46,</span> in <span class="ni">cached_property.__get__</span><span class="nt">(self, obj, cls)</span>
<span class="g g-Whitespace">     </span><span class="mi">44</span> <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">45</span>     <span class="k">return</span> <span class="bp">self</span>
<span class="ne">---&gt; </span><span class="mi">46</span> <span class="n">value</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span> <span class="k">return</span> <span class="n">value</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/mirdata/datasets/saraga_carnatic.py:154,</span> in <span class="ni">Track.tonic</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">152</span> <span class="nd">@core</span><span class="o">.</span><span class="n">cached_property</span>
<span class="g g-Whitespace">    </span><span class="mi">153</span> <span class="k">def</span> <span class="nf">tonic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">154</span>     <span class="k">return</span> <span class="n">load_tonic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctonic_path</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/mirdata/io.py:22,</span> in <span class="ni">coerce_to_string_io.&lt;locals&gt;.wrapper</span><span class="nt">(file_path_or_obj)</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>     <span class="k">return</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_path_or_obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">22</span>     <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path_or_obj</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span>         <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_path_or_obj</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">):</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/smart_open/smart_open_lib.py:177,</span> in <span class="ni">open</span><span class="nt">(uri, mode, buffering, encoding, errors, newline, closefd, opener, compression, transport_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">174</span> <span class="k">if</span> <span class="n">transport_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">175</span>     <span class="n">transport_params</span> <span class="o">=</span> <span class="p">{}</span>
<span class="ne">--&gt; </span><span class="mi">177</span> <span class="n">fobj</span> <span class="o">=</span> <span class="n">_shortcut_open</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">178</span>     <span class="n">uri</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">179</span>     <span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">180</span>     <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">181</span>     <span class="n">buffering</span><span class="o">=</span><span class="n">buffering</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">182</span>     <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">183</span>     <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">184</span>     <span class="n">newline</span><span class="o">=</span><span class="n">newline</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">185</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">186</span> <span class="k">if</span> <span class="n">fobj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">187</span>     <span class="k">return</span> <span class="n">fobj</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/smart_open/smart_open_lib.py:363,</span> in <span class="ni">_shortcut_open</span><span class="nt">(uri, mode, compression, buffering, encoding, errors, newline)</span>
<span class="g g-Whitespace">    </span><span class="mi">360</span> <span class="k">if</span> <span class="n">errors</span> <span class="ow">and</span> <span class="s1">&#39;b&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">361</span>     <span class="n">open_kwargs</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors</span>
<span class="ne">--&gt; </span><span class="mi">363</span> <span class="k">return</span> <span class="n">_builtin_open</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">buffering</span><span class="o">=</span><span class="n">buffering</span><span class="p">,</span> <span class="o">**</span><span class="n">open_kwargs</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;../data/saraga1.5_carnatic/saraga1.5_carnatic/Akkarai Sisters at Arkay by Akkarai Sisters/Koti Janmani/Koti Janmani.ctonic.txt&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This should have been extracted earlier in &quot;extracting predominant pitch tracks&quot;</span>
<span class="n">pitch</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">timestep</span> <span class="o">=</span> <span class="n">load_pitch_track</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pitch_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">track_id</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pitch</span> <span class="o">=</span> <span class="n">interpolate_below_length</span><span class="p">(</span>
    <span class="n">pitch</span><span class="p">,</span> <span class="c1"># track to interpolate</span>
    <span class="mi">0</span><span class="p">,</span> <span class="c1"># value to interpolate </span>
    <span class="mi">350</span><span class="o">*</span><span class="mf">0.001</span><span class="o">/</span><span class="n">timestep</span> <span class="c1"># maximum gap in number sequence elements to interpolate for</span>
<span class="p">)</span>

<span class="n">pitch_cents</span> <span class="o">=</span> <span class="n">pitch_seq_to_cents</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="n">tonic</span><span class="o">=</span><span class="n">tonic</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id='4.1'></a></p>
<section id="melodic-feature-extraction">
<h3>4.1 Melodic feature extraction<a class="headerlink" href="#melodic-feature-extraction" title="Permalink to this headline">#</a></h3>
<p>To identify repeated melodic patterns in our audio we use melodic features computed for windows across the entirety of the track and use the pairwise similarity between these to identify regions of consistent high-similarity… in theory corresponding to melodic repetitions.</p>
<p>In principle, any set of features can be used in this section. The extent to which these features capture the aspects of melody we care about will define their usefulness for the task.</p>
<p>Here we use melodic features extracted using a Complex Autoencoder (CAE). Mapping signals onto complex basis functions learnt by the CAE results in a magnitude space that has proven to achieve state-of-the-art results in repeared section discovery for audio [13].</p>
<p>The CAE we use here is provided via <code class="docutils literal notranslate"><span class="pre">compiam.load_models</span></code> and has been trained on the entirety of the Carnatic Saraga dataset for which we have multitrack recordings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pattern Extraction for a Given Audio</span>
<span class="kn">from</span> <span class="nn">compiam</span> <span class="kn">import</span> <span class="n">load_model</span>

<span class="c1"># Feature Extraction</span>
<span class="c1"># CAE features</span>
<span class="n">cae</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;melody:cae-carnatic&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/compiam/melody/pattern/sancara_search/__init__.py:33,</span> in <span class="ni">CAEWrapper.__init__</span><span class="nt">(self, model_path, conf_path, spec_path, device)</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span> <span class="k">global</span> <span class="n">torch</span>
<span class="ne">---&gt; </span><span class="mi">33</span> <span class="kn">import</span> <span class="nn">torch</span>
<span class="g g-Whitespace">     </span><span class="mi">35</span> <span class="k">global</span> <span class="n">to_cqt_repr</span><span class="p">,</span> <span class="n">standardize</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;torch&#39;

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">ImportError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">86</span><span class="p">],</span> <span class="n">line</span> <span class="mi">6</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">from</span> <span class="nn">compiam</span> <span class="kn">import</span> <span class="n">load_model</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># Feature Extraction</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="c1"># CAE features</span>
<span class="ne">----&gt; </span><span class="mi">6</span> <span class="n">cae</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;melody:cae-carnatic&quot;</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/compiam/__init__.py:44,</span> in <span class="ni">load_model</span><span class="nt">(model_name, data_home, models_dict)</span>
<span class="g g-Whitespace">     </span><span class="mi">37</span>         <span class="n">m_dict</span><span class="p">[</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="n">kp</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">38</span>             <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_home</span><span class="p">,</span> <span class="n">m_dict</span><span class="p">[</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="n">kp</span><span class="p">])</span>
<span class="g g-Whitespace">     </span><span class="mi">39</span>             <span class="k">if</span> <span class="n">data_home</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">40</span>             <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">WORKDIR</span><span class="p">,</span> <span class="n">m_dict</span><span class="p">[</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="n">kp</span><span class="p">])</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span>         <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">43</span> <span class="n">module</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">import_module</span><span class="p">(</span><span class="n">m_dict</span><span class="p">[</span><span class="s2">&quot;module_name&quot;</span><span class="p">]),</span> <span class="n">m_dict</span><span class="p">[</span><span class="s2">&quot;class_name&quot;</span><span class="p">])</span>
<span class="ne">---&gt; </span><span class="mi">44</span> <span class="k">return</span> <span class="n">module</span><span class="p">(</span><span class="o">**</span><span class="n">m_dict</span><span class="p">[</span><span class="s2">&quot;kwargs&quot;</span><span class="p">])</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/compiam/melody/pattern/sancara_search/__init__.py:52,</span> in <span class="ni">CAEWrapper.__init__</span><span class="nt">(self, model_path, conf_path, spec_path, device)</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span>     <span class="kn">from</span> <span class="nn">compiam.melody.pattern.sancara_search.complex_auto.util</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span>         <span class="n">cuda_variable</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span>     <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">51</span> <span class="k">except</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">52</span>     <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span>         <span class="s2">&quot;In order to use this tool you need to have torch installed. &quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">54</span>         <span class="s2">&quot;Please install torch using: pip install torch&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">55</span>     <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span> <span class="c1">###</span>
<span class="g g-Whitespace">     </span><span class="mi">58</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">device</span><span class="p">:</span>

<span class="ne">ImportError</span>: In order to use this tool you need to have torch installed. Please install torch using: pip install torch
</pre></div>
</div>
</div>
</div>
<p>Extracting features across the entirety of our chosen audio…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># returns magnitude and phase</span>
<span class="n">ampl</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cae</span><span class="o">.</span><span class="n">extract_features</span><span class="p">(</span><span class="n">audio_path</span><span class="p">)</span>
<span class="n">ampl</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">87</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># returns magnitude and phase</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">ampl</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cae</span><span class="o">.</span><span class="n">extract_features</span><span class="p">(</span><span class="n">audio_path</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">ampl</span>

<span class="ne">NameError</span>: name &#39;cae&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p><a id='4.2'></a></p>
</section>
<section id="self-similarity">
<h3>4.2 Self similarity<a class="headerlink" href="#self-similarity" title="Permalink to this headline">#</a></h3>
<p>We want to compute the pairwsie self similarity between all combinations of features. With some Carnatic performances lasting up to over an hour, this can often be an expensive computation. There are many regions of the track that we are not interested in (such as silence), or that serve as plausible segmentation points for repeated melodic patterns (such as long periods of stability/silence).</p>
<p><code class="docutils literal notranslate"><span class="pre">compiam.melody.pattern.self_similarity</span></code> provides a method of computing the self similarity whilst skipping the computation for regions defined by a user specified exclusion mask.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">compiam.melody.pattern</span> <span class="kn">import</span> <span class="n">self_similarity</span>
</pre></div>
</div>
</div>
</div>
<p>First let’s compute the mask corresponding to regions we do not want to compute, these are regions of silence:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">silence_mask</span> <span class="o">=</span> <span class="n">pitch</span><span class="o">==</span><span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<p>And regions of consistent stability. To identify regions of consistent stability we use <code class="docutils literal notranslate"><span class="pre">compiam.utils.pitch.extract_stability_mask</span></code>. <code class="docutils literal notranslate"><span class="pre">extract_stability_mask</span></code> computes the average deviation of pitch from the mean in a series of windows across the track. If the deviation exceeds a certain threshold for a sufficient number of consecutive windows, the area is marked as stable (1 in the returned mask), else 0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">compiam.utils.pitch</span> <span class="kn">import</span> <span class="n">extract_stability_mask</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stability_mask</span> <span class="o">=</span> <span class="n">extract_stability_mask</span><span class="p">(</span>
    <span class="n">pitch</span><span class="o">=</span><span class="n">pitch_cents</span><span class="p">,</span> <span class="c1"># pitch track</span>
    <span class="n">min_stab_sec</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="c1"># minimum cummulative length of stable windows to warrant annotation</span>
    <span class="n">hop_sec</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="c1"># hop length in seconds</span>
    <span class="n">var</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="c1"># minimum variation from the mean in each window to be considered stable</span>
    <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span> <span class="c1"># time in seconds between consecutice elements in &lt;pitch&gt;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can inspect the result to check it has worked correctly</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t1</span> <span class="o">=</span> <span class="mi">304</span> <span class="c1"># in seconds</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">+</span> <span class="mi">10</span> <span class="c1"># in seconds</span>

<span class="n">t1s</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">t1</span><span class="o">/</span><span class="n">timestep</span><span class="p">)</span> <span class="c1"># in sequence elements</span>
<span class="n">t2s</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">t2</span><span class="o">/</span><span class="n">timestep</span><span class="p">)</span> <span class="c1"># in sequence elements</span>

<span class="n">this_pitch</span> <span class="o">=</span> <span class="n">pitch</span><span class="p">[</span><span class="n">t1s</span><span class="p">:</span><span class="n">t2s</span><span class="p">]</span>
<span class="n">this_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="n">t1s</span><span class="p">:</span><span class="n">t2s</span><span class="p">]</span>
<span class="n">this_silence_mask</span> <span class="o">=</span> <span class="n">silence_mask</span><span class="p">[</span><span class="n">t1s</span><span class="p">:</span><span class="n">t2s</span><span class="p">]</span>
<span class="n">this_stable_mask</span> <span class="o">=</span> <span class="n">stability_mask</span><span class="p">[</span><span class="n">t1s</span><span class="p">:</span><span class="n">t2s</span><span class="p">]</span>

<span class="c1"># get pitch plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_pitch</span><span class="p">(</span><span class="n">this_pitch</span><span class="p">,</span> <span class="n">this_time</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">this_silence_mask</span><span class="p">,</span> <span class="n">tonic</span><span class="o">=</span><span class="n">tonic</span><span class="p">,</span> <span class="n">yticks_dict</span><span class="o">=</span><span class="n">svara_pitch</span><span class="p">,</span> <span class="n">cents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Excerpt of </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1"> by </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># On alternative axis plot stable mask values</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">this_time</span><span class="p">,</span> <span class="n">this_stable_mask</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Is stable region?&quot;</span><span class="p">)</span>
    
<span class="c1"># accompanying audio</span>
<span class="n">ipy_audio</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">92</span><span class="p">],</span> <span class="n">line</span> <span class="mi">13</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="n">this_stable_mask</span> <span class="o">=</span> <span class="n">stability_mask</span><span class="p">[</span><span class="n">t1s</span><span class="p">:</span><span class="n">t2s</span><span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="c1"># get pitch plot</span>
<span class="ne">---&gt; </span><span class="mi">13</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_pitch</span><span class="p">(</span><span class="n">this_pitch</span><span class="p">,</span> <span class="n">this_time</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">this_silence_mask</span><span class="p">,</span> <span class="n">tonic</span><span class="o">=</span><span class="n">tonic</span><span class="p">,</span> <span class="n">yticks_dict</span><span class="o">=</span><span class="n">svara_pitch</span><span class="p">,</span> <span class="n">cents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Excerpt of </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1"> by </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="c1"># On alternative axis plot stable mask values</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;title&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Here the green line is to be read from the right-hand y-axis… is the region stable or not?</p>
<p>Looks good! Let’s combine the two masks</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">exclusion_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">silence_mask</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="n">stability_mask</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And compute the self similarity <code class="docutils literal notranslate"><span class="pre">self_similarity()</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Mask of regions not interested in cite kaustuv, the papers that use </span>
<span class="n">ss</span> <span class="o">=</span> <span class="n">self_similarity</span><span class="p">(</span>
    <span class="n">ampl</span><span class="p">,</span> <span class="c1"># features</span>
    <span class="n">exclusion_mask</span><span class="o">=</span><span class="n">exclusion_mask</span><span class="p">,</span> <span class="c1"># exclusion mask</span>
    <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span> <span class="c1"># time in seconds between elements of exlcusion mask</span>
    <span class="n">hop_length</span><span class="o">=</span><span class="n">cae</span><span class="o">.</span><span class="n">hop_length</span><span class="p">,</span> <span class="c1"># window size in audio frames</span>
    <span class="n">sr</span><span class="o">=</span><span class="n">cae</span><span class="o">.</span><span class="n">sr</span> <span class="c1"># sample rate of audio</span>
<span class="p">)</span>

<span class="c1"># Sparsely computed self similarity matrix </span>
<span class="n">X</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># Mapping of index between theoretical full matrix and sparse one</span>
<span class="n">orig_sparse_lookup</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># Mapping of index between sparse matrix and theoretical full matrix one</span>
<span class="n">sparse_orig_lookup</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="c1"># Indices of boundaries between split regions in full matrix</span>
<span class="n">boundaries_orig</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="c1"># Indices of boundaries between split regions in sparse matrix</span>
<span class="n">boundaries_sparse</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">94</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Mask of regions not interested in cite kaustuv, the papers that use </span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">ss</span> <span class="o">=</span> <span class="n">self_similarity</span><span class="p">(</span>
<span class="ne">----&gt; </span><span class="mi">3</span>     <span class="n">ampl</span><span class="p">,</span> <span class="c1"># features</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">exclusion_mask</span><span class="o">=</span><span class="n">exclusion_mask</span><span class="p">,</span> <span class="c1"># exclusion mask</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span> <span class="c1"># time in seconds between elements of exlcusion mask</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">hop_length</span><span class="o">=</span><span class="n">cae</span><span class="o">.</span><span class="n">hop_length</span><span class="p">,</span> <span class="c1"># window size in audio frames</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">sr</span><span class="o">=</span><span class="n">cae</span><span class="o">.</span><span class="n">sr</span> <span class="c1"># sample rate of audio</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="c1"># Sparsely computed self similarity matrix </span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="n">X</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;ampl&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>How does the self similarity matrix look?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Self similarity matrix for </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">2000</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span><span class="mi">2000</span><span class="p">:</span><span class="mi">5000</span><span class="p">],</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">95</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Self similarity matrix for </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">2000</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span><span class="mi">2000</span><span class="p">:</span><span class="mi">5000</span><span class="p">],</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;title&#39; is not defined
</pre></div>
</div>
<img alt="../_images/exploring-raga_178_1.png" src="../_images/exploring-raga_178_1.png" />
</div>
</div>
<p><a id='4.3'></a></p>
</section>
<section id="segment-extraction">
<h3>4.3 Segment extraction<a class="headerlink" href="#segment-extraction" title="Permalink to this headline">#</a></h3>
<p>Diagonal segments in this self similarity matrix correspond to two regions of consistent high similarity (one on the x axis and y axis). We want to extract and define these segments.</p>
<p>Instances of the same sañcāra are often performed slightly differently. Tempo differences mean that the segments cannot be expected to be parallel to the y=x diagonal. Differences in ornamention or differences in elaboration (such as the insertion of additional svaras or gamakas) mean that segments are sometimes not completely consistent unbroken lines, terminating and ending at exactly the same place</p>
<p>To deal with extraction in this context we use the segment extractor at <code class="docutils literal notranslate"><span class="pre">compiam.melody.pattern.segmentExtractor</span></code> which is adapted from [12] and built specifically for the Carnatic Music context.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">compiam.melody.pattern</span> <span class="kn">import</span> <span class="n">segmentExtractor</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Emphasize Diagonal</span>
<span class="n">se</span> <span class="o">=</span> <span class="n">segmentExtractor</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="c1"># self sim matrix</span>
    <span class="n">window_size</span><span class="o">=</span><span class="n">cae</span><span class="o">.</span><span class="n">hop_length</span><span class="p">,</span> <span class="c1"># window size</span>
    <span class="n">cache_dir</span><span class="o">=</span><span class="s1">&#39;.cache/&#39;</span> <span class="c1"># cache directory for faster computation in future</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">97</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Emphasize Diagonal</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">se</span> <span class="o">=</span> <span class="n">segmentExtractor</span><span class="p">(</span>
<span class="ne">----&gt; </span><span class="mi">3</span>     <span class="n">X</span><span class="p">,</span> <span class="c1"># self sim matrix</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">window_size</span><span class="o">=</span><span class="n">cae</span><span class="o">.</span><span class="n">hop_length</span><span class="p">,</span> <span class="c1"># window size</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">cache_dir</span><span class="o">=</span><span class="s1">&#39;.cache/&#39;</span> <span class="c1"># cache directory for faster computation in future</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;X&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>First we emphasize existing segments using a series of image processing techiniques:</p>
<ul class="simple">
<li><p>Convolution with a sobel filter to emphasize edges</p></li>
<li><p>Normalise similarities to between 1 and 0</p></li>
<li><p>Binarize matrix to 0/1 above or below some threshold</p></li>
<li><p>Since the emphasized edges correspond to the borders of the segment and not the segment itself we apply morphological closing to fill gaps</p></li>
<li><p>Finally we apply morphological closing to smooth and remove noisy artifacts</p></li>
</ul>
<div>
<figure>
<img src="../images/emphasizing_diagonals.png" width="500"/>
</figure>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_proc</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">emphasize_diagonals</span><span class="p">()</span>
<span class="n">se</span><span class="o">.</span><span class="n">display_matrix</span><span class="p">(</span><span class="n">X_proc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">98</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">X_proc</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">emphasize_diagonals</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">se</span><span class="o">.</span><span class="n">display_matrix</span><span class="p">(</span><span class="n">X_proc</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;se&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>We can tune parameters visually using the <code class="docutils literal notranslate"><span class="pre">se.display_matrix</span></code> to view the processed plot. One of the most important parameters is the binary threshold, <code class="docutils literal notranslate"><span class="pre">bin_thresh</span></code>. Let’s iterate through a sample and choose one that balances noise and segment integrity</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">):</span>
    <span class="n">X_proc</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">emphasize_diagonals</span><span class="p">(</span><span class="n">bin_thresh</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
    <span class="n">se</span><span class="o">.</span><span class="n">display_matrix</span><span class="p">(</span><span class="n">X_proc</span><span class="p">[</span><span class="mi">2000</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span><span class="mi">2000</span><span class="p">:</span><span class="mi">5000</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;bin_thresh=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">99</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="n">X_proc</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">emphasize_diagonals</span><span class="p">(</span><span class="n">bin_thresh</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">se</span><span class="o">.</span><span class="n">display_matrix</span><span class="p">(</span><span class="n">X_proc</span><span class="p">[</span><span class="mi">2000</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span><span class="mi">2000</span><span class="p">:</span><span class="mi">5000</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;bin_thresh=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="ne">NameError</span>: name &#39;se&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>We are looking for a solution that reduces the “speccy” noise parts and leaves strong, consistent diagonal segments.
0.1 seems like an OK choice</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_proc</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">emphasize_diagonals</span><span class="p">(</span><span class="n">bin_thresh</span><span class="o">=</span><span class="mf">0.10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">100</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">X_proc</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">emphasize_diagonals</span><span class="p">(</span><span class="n">bin_thresh</span><span class="o">=</span><span class="mf">0.10</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;se&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Finally we extract segments using a combination of geometric techniques:</p>
<ul class="simple">
<li><p>Identify individual regions of non 0 values using a two-pass binary connected-components labelling algorithm (CCL)</p></li>
<li><p>Identify centroid of region</p></li>
<li><p>Idenitfy quadrant centroids</p></li>
<li><p>Define path through these centroids using least squares</p></li>
<li><p>Terminate path at bounding box of segment</p></li>
</ul>
<div>
<figure>
<img src="../images/extracting_segments.png" width="500"/>
</figure>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_segments</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">extract_segments</span><span class="p">(</span>
    <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span> <span class="c1"># timestep between</span>
    <span class="n">boundaries</span><span class="o">=</span><span class="n">boundaries_sparse</span><span class="p">,</span> <span class="c1"># boundaries of sparse regions (for conversion)</span>
    <span class="n">lookup</span><span class="o">=</span><span class="n">sparse_orig_lookup</span><span class="p">,</span> <span class="c1"># To convert between sparse and true indices</span>
    <span class="n">break_mask</span><span class="o">=</span><span class="n">exclusion_mask</span><span class="p">)</span> <span class="c1"># mask corresponding to break points, any segment that traverse these points are broken into two</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">101</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">all_segments</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">extract_segments</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span> <span class="c1"># timestep between</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">boundaries</span><span class="o">=</span><span class="n">boundaries_sparse</span><span class="p">,</span> <span class="c1"># boundaries of sparse regions (for conversion)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">lookup</span><span class="o">=</span><span class="n">sparse_orig_lookup</span><span class="p">,</span> <span class="c1"># To convert between sparse and true indices</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">break_mask</span><span class="o">=</span><span class="n">exclusion_mask</span><span class="p">)</span> <span class="c1"># mask corresponding to break points, any segment that traverse these points are broken into two</span>

<span class="ne">NameError</span>: name &#39;se&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Format: [(x0, y0), (x1, y1)]...&quot;</span><span class="p">)</span>
<span class="n">all_segments</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Format: [(x0, y0), (x1, y1)]...
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">102</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Format: [(x0, y0), (x1, y1)]...&quot;</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">all_segments</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;all_segments&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p><a id='4.4'></a></p>
</section>
<section id="segment-grouping">
<h3>4.4 Segment grouping<a class="headerlink" href="#segment-grouping" title="Permalink to this headline">#</a></h3>
<p>Each segment corresponds to two regions of the audio, one on the x axis and one on the y axis. We want to convert these segments to start and end points of individual patterns and group these patterns into groups of occurrences of the same pattern.</p>
<p><code class="docutils literal notranslate"><span class="pre">segmentExtractor</span></code> has a grouping method which achieves this using a combination of the gemoetry of X and pairwise distances between patterns. First segments are grouped based on their alignment in the x and y direction. Subsequently, groups are merged together based on the average dynamic-time-warping distance between them.</p>
<p>A mask corresponding to anchor points to which we might want to extent returned patterns to can be passed to <code class="docutils literal notranslate"><span class="pre">segmentExtractor.group_segments</span></code> and any patterns that end or begin close to these points will be extended to them. Since regions of silence and stability serve as plasusible segmentation points between patterns we pass a mask indicating where the centers are for these regions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">compiam.utils</span> <span class="kn">import</span> <span class="n">add_center_to_mask</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exclusion_mask_center</span> <span class="o">=</span> <span class="n">add_center_to_mask</span><span class="p">(</span><span class="n">exclusion_mask</span><span class="p">)</span>
<span class="n">anchor_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">2</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">exclusion_mask_center</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns patterns in units of pitch sequence elements</span>
<span class="n">starts_seq</span><span class="p">,</span> <span class="n">lengths_seq</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">group_segments</span><span class="p">(</span>
    <span class="n">all_segments</span><span class="p">,</span> <span class="c1"># segments from se.extract_segments()</span>
    <span class="n">anchor_mask</span><span class="p">,</span> <span class="c1"># Extend patterns to these points</span>
    <span class="n">pitch</span><span class="p">,</span> <span class="c1"># pitch track</span>
    <span class="n">min_pattern_length_seconds</span><span class="o">=</span><span class="mi">2</span> <span class="c1"># minimum pattern length</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The process returns groups of patterns in terms of start point and length. The units for these patterns correspond to elements in the pitch track. We can convert to seconds as so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">starts_sec</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span><span class="o">*</span><span class="n">timestep</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">starts_seq</span><span class="p">]</span>
<span class="n">lengths_sec</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span><span class="o">*</span><span class="n">timestep</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lengths_seq</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">106</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">starts_sec</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span><span class="o">*</span><span class="n">timestep</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">starts_seq</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">lengths_sec</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span><span class="o">*</span><span class="n">timestep</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lengths_seq</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;starts_seq&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of groups: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">starts_sec</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">107</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of groups: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">starts_sec</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;starts_sec&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p><a id='4.5'></a></p>
</section>
<section id="exploring-results">
<h3>4.5 Exploring results<a class="headerlink" href="#exploring-results" title="Permalink to this headline">#</a></h3>
<p>Let’s take a look at some results. <code class="docutils literal notranslate"><span class="pre">compiam.visualisation.pitch.plot_subsequence</span></code> is a wrapper for<code class="docutils literal notranslate"><span class="pre">compiam.visualisation.pitch.plot_pitch</span></code> that allows us to inspect subsequences of a pitch plot with their surrounding melodic context</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">compiam.visualisation.pitch</span> <span class="kn">import</span> <span class="n">plot_subsequence</span>
<span class="kn">import</span> <span class="nn">IPython</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># kwargs for plot_pitch</span>
<span class="n">plot_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;yticks_dict&#39;</span><span class="p">:</span> <span class="n">svara_pitch</span><span class="p">,</span>
    <span class="s1">&#39;cents&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;tonic&#39;</span><span class="p">:</span><span class="n">tonic</span><span class="p">,</span>
    <span class="s1">&#39;figsize&#39;</span><span class="p">:(</span><span class="mi">15</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="mi">7</span> <span class="c1"># Choose pattern group</span>

<span class="n">S</span> <span class="o">=</span> <span class="n">starts_seq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="c1"># get group</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">lengths_seq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="c1"># get lengths</span>

<span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">S</span><span class="p">):</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="c1"># this pattern length</span>
    <span class="n">ss</span> <span class="o">=</span> <span class="n">starts_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="c1"># this pattern start in seconds</span>
    <span class="n">ls</span> <span class="o">=</span> <span class="n">lengths_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="c1"># this pattern length in seconds</span>
    <span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">ipy_audio</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="n">ss</span><span class="o">+</span><span class="n">ls</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">))</span> <span class="c1"># display audio</span>
    <span class="c1"># display pitch plot</span>
    <span class="n">plot_subsequence</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="n">plot_kwargs</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">110</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">7</span> <span class="c1"># Choose pattern group</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">S</span> <span class="o">=</span> <span class="n">starts_seq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="c1"># get group</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">L</span> <span class="o">=</span> <span class="n">lengths_seq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="c1"># get lengths</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">S</span><span class="p">):</span>

<span class="ne">NameError</span>: name &#39;starts_seq&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p><a id='4.6'></a></p>
</section>
<section id="annotations">
<h3>4.6 Annotations<a class="headerlink" href="#annotations" title="Permalink to this headline">#</a></h3>
<p>Ground-truth annotations of sañcāras in certain audio recordings were created by contributor and professional vocalist, Brindha Manickavasakan. Annotations were created in Carnatic notation, known as sargam [14]. As there is no definitive list of sañcāras in a given rāga, the segmentations are based on the annotator’s experience as a professional performer and student of a highly esteemed musical lineage. These annotations are therefore subjective to some degree, but have the benefit of being based on expert performer knowledge rather than on an externally imposed metric that may be irrelevant to musical concepts held by culture bearers [12].</p>
<p>The annotations can be loaded using <code class="docutils literal notranslate"><span class="pre">compiam.load_dataset</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">compiam.melody.pattern</span> <span class="kn">import</span> <span class="n">load_annotations</span><span class="p">,</span> <span class="n">to_aeneas</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">annotations_path</span> <span class="o">=</span> <span class="s2">&quot;../../annotations/47_Koti_Janmani.txt&quot;</span>
<span class="n">annotations</span> <span class="o">=</span> <span class="n">load_annotations</span><span class="p">(</span><span class="n">annotations_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">112</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">annotations_path</span> <span class="o">=</span> <span class="s2">&quot;../../annotations/47_Koti_Janmani.txt&quot;</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">annotations</span> <span class="o">=</span> <span class="n">load_annotations</span><span class="p">(</span><span class="n">annotations_path</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/compiam/melody/pattern/sancara_search/extraction/evaluation.py:11,</span> in <span class="ni">load_annotations</span><span class="nt">(annotations_path, min_m, max_m, underlying)</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="k">def</span> <span class="nf">load_annotations</span><span class="p">(</span><span class="n">annotations_path</span><span class="p">,</span> <span class="n">min_m</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">underlying</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">11</span>     <span class="n">annotations_orig</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">annotations_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="n">annotations_orig</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;tier&quot;</span><span class="p">,</span> <span class="s2">&quot;not_used&quot;</span><span class="p">,</span> <span class="s2">&quot;s1&quot;</span><span class="p">,</span> <span class="s2">&quot;s2&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>     <span class="n">annotations_orig</span><span class="p">[</span><span class="s2">&quot;s1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">annotations_orig</span><span class="p">[</span><span class="s2">&quot;s1&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>         <span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>     <span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/pandas/io/parsers/readers.py:912,</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, date_format, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options, dtype_backend)</span>
<span class="g g-Whitespace">    </span><span class="mi">899</span> <span class="n">kwds_defaults</span> <span class="o">=</span> <span class="n">_refine_defaults_read</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">900</span>     <span class="n">dialect</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">901</span>     <span class="n">delimiter</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">908</span>     <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">909</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">910</span> <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">912</span> <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/pandas/io/parsers/readers.py:577,</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">574</span> <span class="n">_validate_names</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">576</span> <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">577</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">579</span> <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">580</span>     <span class="k">return</span> <span class="n">parser</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/pandas/io/parsers/readers.py:1407,</span> in <span class="ni">TextFileReader.__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">   </span><span class="mi">1404</span>     <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">1406</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span> <span class="n">IOHandles</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">-&gt; </span><span class="mi">1407</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/pandas/io/parsers/readers.py:1661,</span> in <span class="ni">TextFileReader._make_engine</span><span class="nt">(self, f, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1659</span>     <span class="k">if</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1660</span>         <span class="n">mode</span> <span class="o">+=</span> <span class="s2">&quot;b&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1661</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="n">get_handle</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1662</span>     <span class="n">f</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1663</span>     <span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1664</span>     <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1665</span>     <span class="n">compression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1666</span>     <span class="n">memory_map</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1667</span>     <span class="n">is_text</span><span class="o">=</span><span class="n">is_text</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1668</span>     <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1669</span>     <span class="n">storage_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1670</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1671</span> <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1672</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="o">.</span><span class="n">handle</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/pandas/io/common.py:859,</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">854</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">855</span>     <span class="c1"># Check whether the filename is to be opened in binary mode.</span>
<span class="g g-Whitespace">    </span><span class="mi">856</span>     <span class="c1"># Binary mode does not support &#39;encoding&#39; and &#39;newline&#39;.</span>
<span class="g g-Whitespace">    </span><span class="mi">857</span>     <span class="k">if</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">and</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>         <span class="c1"># Encoding</span>
<span class="ne">--&gt; </span><span class="mi">859</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">860</span>             <span class="n">handle</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>             <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="n">encoding</span><span class="o">=</span><span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">863</span>             <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">864</span>             <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">865</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">866</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">867</span>         <span class="c1"># Binary mode</span>
<span class="g g-Whitespace">    </span><span class="mi">868</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;../../annotations/47_Koti_Janmani.txt&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">annotations</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">113</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">annotations</span>

<span class="ne">NameError</span>: name &#39;annotations&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>The waveform player presented in Section 1 accepts annotations in <a class="reference external" href="https://www.readbeyond.it/aeneas/docs/">aeneas format</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aeneas_annotations</span> <span class="o">=</span> <span class="n">to_aeneas</span><span class="p">(</span><span class="n">annotations</span><span class="p">,</span> <span class="n">label_row</span><span class="o">=</span><span class="s1">&#39;text_full&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">114</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">aeneas_annotations</span> <span class="o">=</span> <span class="n">to_aeneas</span><span class="p">(</span><span class="n">annotations</span><span class="p">,</span> <span class="n">label_row</span><span class="o">=</span><span class="s1">&#39;text_full&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;annotations&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Player</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">audio_path</span><span class="p">,</span> <span class="n">aeneas_annotations</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">115</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">Player</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">audio_path</span><span class="p">,</span> <span class="n">aeneas_annotations</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;title&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p><a id='4.7'></a></p>
</section>
<section id="evaluation">
<h3>4.7 Evaluation<a class="headerlink" href="#evaluation" title="Permalink to this headline">#</a></h3>
<p>We can evaluate our returned results using the ground truth annotations and traditional IR metrics. Recall, precision and f1. A true positive is considered when overlap between a returned pattern and an annotated pattern as a proportion of their length is equal to or exceeds a certain threshold, <code class="docutils literal notranslate"><span class="pre">partial_perc</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">compiam.melody.pattern</span> <span class="kn">import</span> <span class="n">evaluate</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">partial_perc</span> <span class="o">=</span> <span class="mf">0.66</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">annotations_ev</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">annotations</span><span class="p">,</span> <span class="n">starts_sec</span><span class="p">,</span> <span class="n">lengths_sec</span><span class="p">,</span> <span class="n">partial_perc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;recall: </span><span class="si">{</span><span class="n">recall</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;precision: </span><span class="si">{</span><span class="n">precision</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;f1: </span><span class="si">{</span><span class="n">f1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">118</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">annotations_ev</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">annotations</span><span class="p">,</span> <span class="n">starts_sec</span><span class="p">,</span> <span class="n">lengths_sec</span><span class="p">,</span> <span class="n">partial_perc</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;recall: </span><span class="si">{</span><span class="n">recall</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;precision: </span><span class="si">{</span><span class="n">precision</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;annotations&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>We can take an example patttern and see the extent to which the process has identified it. For example, nnnsndmgm. Corresponding to group 9:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">annotations_ev</span><span class="p">[</span><span class="n">annotations_ev</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;nnnsndmgm&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">119</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">annotations_ev</span><span class="p">[</span><span class="n">annotations_ev</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;nnnsndmgm&quot;</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;annotations_ev&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="mi">9</span> <span class="c1"># Choose pattern group</span>

<span class="n">S</span> <span class="o">=</span> <span class="n">starts_seq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="c1"># get group</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">lengths_seq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="c1"># get lengths</span>

<span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">S</span><span class="p">):</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="c1"># this pattern length</span>
    <span class="n">ss</span> <span class="o">=</span> <span class="n">starts_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="c1"># this pattern start in seconds</span>
    <span class="n">ls</span> <span class="o">=</span> <span class="n">lengths_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="c1"># this pattern length in seconds</span>
    <span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">ipy_audio</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="n">ss</span><span class="o">+</span><span class="n">ls</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">))</span> <span class="c1"># display audio</span>
    <span class="c1"># display pitch plot</span>
    <span class="n">plot_subsequence</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="n">plot_kwargs</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">120</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">9</span> <span class="c1"># Choose pattern group</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">S</span> <span class="o">=</span> <span class="n">starts_seq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="c1"># get group</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">L</span> <span class="o">=</span> <span class="n">lengths_seq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="c1"># get lengths</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">S</span><span class="p">):</span>

<span class="ne">NameError</span>: name &#39;starts_seq&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>These results differ in their annotations, but were given the same “underlying sañcāra” annotation, indicating they are elaborations on an earlier phrase. The pattern finding process picked up the underlying similarity, even though the actual notation that would be, and indeed was, given for these differs.</p>
<p><a id='4.8'></a></p>
</section>
<section id="discussion">
<h3>4.8 Discussion<a class="headerlink" href="#discussion" title="Permalink to this headline">#</a></h3>
<p>Obtaining a decent evaluation for a high <code class="docutils literal notranslate"><span class="pre">partial_perc</span></code> is very difficult. This is due to many factors, the many faceted process often trades off one desirable feature for another: leniancy in the threshold for significance leads to mistakes filtering through; a more relaxed grouping to capture instances of the same sancara lead to regions of what is clearly not the same pattern to be grouped; a more flexible DTW threshold for grouping causes greater length variation within groups.</p>
<p>On top of this, the ideal boundary between shorter segments within a longer phrase is not always clear-cut, it is clear that often a longer phrase may be plausibly segmented in two or three different ways. However, there are rules of raga grammar, and understandings of typical sañca¯ras that restrict the number of plausible segmentation points. (This is similar to the segmentation of Western Art Music, where in any given section, several plausible segmentations may be made, but where the options are not unlimited).</p>
<p>The potential for this process at the moment is the ability to reliably shine a light on regions of the audio that may correspond to or overlap with what are considered relevant motifs and phrases.</p>
<p><a id='5'></a></p>
</section>
</section>
<section id="conclusion">
<h2>5. Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">#</a></h2>
<p>We have explored three core aspects of raga in Carnatic music using the compIAM tools repository - svaras (pitch), gamakas (ornamentation), and sancaras (melody). Touching on topics such as melodic feature extraction, tonic/svara identification, raga classification, repeated melodic pattern recognition, pitch visualisation.</p>
<p>All tools and proccesses presented here are openly available and accessible at the <a class="reference external" href="https://github.com/MTG/compIAM/tree/master/compiam">online repository</a>, technical documentation is available at our <a class="reference external" href="https://mtg.github.io/compIAM/">sphinx page</a> and an online web book with code walkthroughs and musicological background available in our <a class="reference external" href="https://mtg.github.io/IAM-tutorial-ismir22/landing.html">webbook</a>.</p>
<p>compIAM is in it’s infancy and growing in size and number of contributors. If you would like to get involved and contribute to this repository of tools for the computational analysis of Indian Art Music, or want to get in touch for any other related question or feedback you can do so by contacting <a class="reference external" href="mailto:thomas&#46;nuttall&#37;&#52;&#48;upf&#46;edu">Thomas Nuttall</a> or <a class="reference external" href="mailto:genis&#46;plaja&#37;&#52;&#48;upf&#46;edu">Genís Plaja-Roglans</a>.
<a id='6'></a></p>
</section>
<section id="references">
<h2>6. References<a class="headerlink" href="#references" title="Permalink to this headline">#</a></h2>
<p>[1] Lara Pearson, Brindha Manickavasakan (2022). Computational Methods for Supporting Corpus-Based Research on Indian Art Music, What is Indian Art Music?. <a class="reference external" href="https://mtg.github.io/IAM-tutorial-ismir22">https://mtg.github.io/IAM-tutorial-ismir22</a>.</p>
<p>[2] N. Ramanathan. Sargam and musical conception in Karnataka system. In Sargam as a musical material. Mumbai, 2004. Dr. Prabha Atrre Foundation, Pu. La. Deshpande Maharashtra Kala Academy.</p>
<p>[3] Tanjore Viswanathan. The Analysis of Rāga ālāpana in South Indian Music. Asian Music, 9(1):13–71, 1977.</p>
<p>[4] Ludwig Pesch. The Oxford illustrated companion to South Indian classical music. Oxford University Press, New Delhi, 2009. ISBN 0-19-564382-8</p>
<p>[5] Vignesh Ishwar, Shrey Dutta, Ashwin Bellur, and Hema A Murthy. Motif Spotting in an Alapana in Carnatic Music. In Proc. of the 14th International Society for Music Information Retrieval Conference (ISMIR), Curitiba, Brazil, 499–504. 2013.</p>
<p>[6] Nuttall, Thomas, Genís Plaja, Lara Pearson, and Xavier Serra. “The Matrix profile for motif discovery in audio-an example application in Carnatic music.” In Proc. of the 15th International Symposium on Computer Music Multidisciplinary Research; 2021.</p>
<p>[7] Pearson, L.: Coarticulation and gesture: an analysis of melodic movement in South Indian rāga performance. In: Music Analysis, 35(3), pp. 280-313 (2016)</p>
<p>[8]  G. Plaja-Roglans, T. Nuttall, L. Pearson, and X. Serra, “Repertoire specific vocal pitch data generation for improved melodic analysis of carnatic music,” 2022. [Online]. Available: 10.5281/zenodo.7036117</p>
<p>[9] S. Yu, X. Sun, Y. Yu, and W. Li, “Frequency-Temporal Attention Network for Singing Melody Extraction,” In Proc. of the IEEE Int. Conf. on Acoustics, Speech and Signal Processing (ICASSP), Toronto, Canada, pp.
251–255, 2021.</p>
<p>[10] TBA. (2021). Saraga-Carnatic-Melody-Synth (1.0) [Data set]. Zenodo. <a class="reference external" href="https://doi.org/10.5281/zenodo.5553925">https://doi.org/10.5281/zenodo.5553925</a></p>
<p>[11] T. Viswanathan, “The analysis of raga alapana in South Indian music,” Asian Music, vol. 9, no. 1, pp. 13–71, 1977.</p>
<p>[12] Nuttall, Thomas, Genís Plaja-Roglans, Lara Pearson, and Xavier Sierra. “In search of Sañcāras: tradition-informed repeated melodic pattern recognition in carnatic music.” (2022).</p>
<p>[13] S. Lattner, A. Arzt, and M. Dörfler, “Learning complex basis functions for invariant representations of audio,” In Proc. of the 20th Int. Society for Music Information Retrieval Conf. (ISMIR), Delft, The Netherlands, 2019.</p>
<p>[14] N. Ramanathan, “Sargam and musical conception in karnataka system’,” Sargam as a musical material, 2004.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "MTG/IAM-tutorial-ismir22",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./melodic_analysis"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Thomas Nuttall, Genís Plaja-Roglans, Lara Pearson, Brindha Manickavasakan, Kaustuv Kanti Ganguli, Ajay Srinivasamurthy and Xavier Serra<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>